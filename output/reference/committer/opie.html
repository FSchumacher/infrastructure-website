<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />
        <title>Using OPIE</title>
        <link rel="stylesheet" href="https://infra-test.apache.org/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://infra-test.apache.org/">Apache Infrastructure</a></h1>
                <nav><ul>
                    <li><a href="https://infra-test.apache.org/./apache-and-github.html">Apache and GitHub</a></li>
                    <li><a href="https://infra-test.apache.org/./application-upgrades-policy-and-workflow.html">Application upgrades policy and workflow</a></li>
                    <li><a href="https://infra-test.apache.org/./distributing-through-the-apple-developer-program.html">Distributing through the Apple Developer Program</a></li>
                    <li><a href="https://infra-test.apache.org/./applying-the-apache-license-version-20.html">Applying the Apache license, version 2.0</a></li>
                    <li><a href="https://infra-test.apache.org/./asf-pelican-feature-branches.html">ASF Pelican feature branches</a></li>
                    <li><a href="https://infra-test.apache.org/./asf-pelican-data-model.html">ASF Pelican data model</a></li>
                    <li><a href="https://infra-test.apache.org/./asf-pelican-getting-started-guide.html">ASF-Pelican getting-started guide</a></li>
                    <li><a href="https://infra-test.apache.org/./local-pelican-builds.html">Local Pelican builds</a></li>
                    <li><a href="https://infra-test.apache.org/./asf-pelican-plugins.html">ASF Pelican plugins</a></li>
                    <li><a href="https://infra-test.apache.org/./apache-theme-for-asf-pelican.html">Apache Theme for ASF Pelican</a></li>
                    <li><a href="https://infra-test.apache.org/./asf-pelican.html">ASF-Pelican</a></li>
                    <li><a href="https://infra-test.apache.org/./asfbot-irc-services-and-archives.html">ASFBot: IRC services and archives</a></li>
                    <li><a href="https://infra-test.apache.org/./backup-policy.html">Backup policy</a></li>
                    <li><a href="https://infra-test.apache.org/./writing-a-good-bug-report.html">Writing a good bug report</a></li>
                    <li><a href="https://infra-test.apache.org/./committer-email.html">Committer Email</a></li>
                    <li><a href="https://infra-test.apache.org/./policy-for-outreach-to-committers.html">Policy for Outreach to Committers</a></li>
                    <li><a href="https://infra-test.apache.org/./committers-faqs.html">Committers' FAQs</a></li>
                    <li><a href="https://infra-test.apache.org/./contact-the-infrastructure-team.html">Contact the Infrastructure Team</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/contactinfra.html">Contacting Infrastructure</a></li>
                    <li><a href="https://infra-test.apache.org/./tips-for-apache-project-email-contributors.html">Tips for Apache project email contributors</a></li>
                    <li><a href="https://infra-test.apache.org/./guide-for-new-project-contributors.html">Guide for new project contributors</a></li>
                    <li><a href="https://infra-test.apache.org/./handling-cryptography-within-an-asf-release.html">Handling cryptography within an ASF release</a></li>
                    <li><a href="https://infra-test.apache.org/./confluence-wiki-space-for-your-project.html">Confluence Wiki space for your project</a></li>
                    <li><a href="https://infra-test.apache.org/./requesting-access-to-the-digicert-code-signing-service.html">Requesting access to the Digicert code signing service</a></li>
                    <li><a href="https://infra-test.apache.org/./using-the-digicert-code-signing-service.html">Using the Digicert code signing service</a></li>
                    <li><a href="https://infra-test.apache.org/./documentation.html">Documentation</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/email.html">Committer e-mail configuration</a></li>
                    <li><a href="https://infra-test.apache.org/./fingerprints.html">Fingerprints</a></li>
                    <li><a href="https://infra-test.apache.org/./github-flavored-markdown.html">GitHub Flavored Markdown</a></li>
                    <li><a href="https://infra-test.apache.org/./getting-started-with-git.html">Getting started with Git</a></li>
                    <li><a href="https://infra-test.apache.org/./git-access-to-apache-subversion-codebases.html">Git access to Apache Subversion codebases</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/git.html">Getting started with Git</a></li>
                    <li><a href="https://infra-test.apache.org/./github-actions-policy.html">GitHub Actions Policy</a></li>
                    <li><a href="https://infra-test.apache.org/./github-actions-and-secrets.html">GitHub Actions and Secrets</a></li>
                    <li><a href="https://infra-test.apache.org/./github-pages-for-projects.html">GitHub Pages for projects</a></li>
                    <li><a href="https://infra-test.apache.org/./roles-for-project-github-repositories.html">Roles for project GitHub repositories</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/github.html">Apache and GitHub</a></li>
                    <li><a href="https://infra-test.apache.org/./host-a-jenkins-or-buildbot-agent.html">Host a Jenkins or Buildbot agent</a></li>
                    <li><a href="https://infra-test.apache.org/./how-to-be-an-apache-software-foundation-download-mirror.html">How to be an Apache Software Foundation download mirror</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/id.html">Changing your account details (self serve)</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/index.html">Committer Documentation</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/index.html">Reference Documentation</a></li>
                    <li><a href="https://infra-test.apache.org/./self-serve-tools.html">Self-serve Tools</a></li>
                    <li><a href="https://infra-test.apache.org/./site-wide-ban-policy.html">Site-wide ban policy</a></li>
                    <li><a href="https://infra-test.apache.org/./details-on-contacting-infra.html">Details on contacting Infra</a></li>
                    <li><a href="https://infra-test.apache.org/./infra-and-the-incubator.html">Infra and the Incubator</a></li>
                    <li><a href="https://infra-test.apache.org/./apache-infrastructure-mailing-lists.html">Apache Infrastructure mailing lists</a></li>
                    <li><a href="https://infra-test.apache.org/./volunteering-for-apache-infrastructure.html">Volunteering for Apache Infrastructure</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/jenkins-docker.html">Using Docker with builds.apache.org</a></li>
                    <li><a href="https://infra-test.apache.org/./guidelines-for-creating-a-jira-ticket.html">Guidelines for creating a Jira ticket</a></li>
                    <li><a href="https://infra-test.apache.org/./how-to-transition-to-a-new-pgp-key.html">How to transition to a new PGP key</a></li>
                    <li><a href="https://infra-test.apache.org/./assembling-license-and-notice-files.html">Assembling LICENSE and NOTICE files</a></li>
                    <li><a href="https://infra-test.apache.org/./localization.html">Localization</a></li>
                    <li><a href="https://infra-test.apache.org/./machines-and-fingerprints.html">Machines and Fingerprints</a></li>
                    <li><a href="https://infra-test.apache.org/./mail-rejection-policy.html">Mail Rejection Policy</a></li>
                    <li><a href="https://infra-test.apache.org/./mailing-list-moderation.html">Mailing list moderation</a></li>
                    <li><a href="https://infra-test.apache.org/./managing-project-committers.html">Managing Project Committers</a></li>
                    <li><a href="https://infra-test.apache.org/./apache-mirroring-information.html">Apache mirroring information</a></li>
                    <li><a href="https://infra-test.apache.org/./guide-for-new-project-committers.html">Guide for new project committers</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/newaccount.html">Guide to new committers</a></li>
                    <li><a href="https://infra-test.apache.org/./open-access-svn.html">Open-access SVN</a></li>
                    <li><a href="https://infra-test.apache.org/./cryptography-with-openpgp.html">Cryptography with OpenPGP</a></li>
                    <li class="active"><a href="https://infra-test.apache.org/./reference/committer/opie.html">Using OPIE</a></li>
                    <li><a href="https://infra-test.apache.org/./operating-system-upgrade-policy.html">Operating system upgrade policy</a></li>
                    <li><a href="https://infra-test.apache.org/./how-to-submit-a-patch-for-project-code.html">How to submit a patch for project code</a></li>
                    <li><a href="https://infra-test.apache.org/./build-and-manage-a-project-website-with-pelican-and-buildbot.html">Build and manage a project website with Pelican and Buildbot</a></li>
                    <li><a href="https://infra-test.apache.org/./infra-policies.html">Infra policies</a></li>
                    <li><a href="https://infra-test.apache.org/./project-blog.html">Project Blog</a></li>
                    <li><a href="https://infra-test.apache.org/./project-and-product-names.html">Project and product names</a></li>
                    <li><a href="https://infra-test.apache.org/./project-site-policy.html">Project site policy</a></li>
                    <li><a href="https://infra-test.apache.org/./managing-your-project-web-site.html">Managing your project web site</a></li>
                    <li><a href="https://infra-test.apache.org/./publishing-maven-releases-to-maven-central-repository.html">Publishing Maven Releases to Maven Central Repository</a></li>
                    <li><a href="https://infra-test.apache.org/./subscribe-to-apache-software-foundation-infrastructure-events.html">Subscribe to Apache Software Foundation infrastructure events</a></li>
                    <li><a href="https://infra-test.apache.org/./release-distribution-policy.html">Release Distribution Policy</a></li>
                    <li><a href="https://infra-test.apache.org/./release-download-pages-for-projects.html">Release Download Pages for Projects</a></li>
                    <li><a href="https://infra-test.apache.org/./release-creation-process.html">Release Creation Process</a></li>
                    <li><a href="https://infra-test.apache.org/./signing-releases.html">Signing Releases</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/release.html">Releasing project packages</a></li>
                    <li><a href="https://infra-test.apache.org/./repository-access-policy.html">Repository access policy</a></li>
                    <li><a href="https://infra-test.apache.org/./apache-maven-repositories.html">Apache Maven repositories</a></li>
                    <li><a href="https://infra-test.apache.org/./requesting-an-issue-and-feature-request-tracker-for-a-project.html">Requesting an issue and feature-request tracker for a project</a></li>
                    <li><a href="https://infra-test.apache.org/./response-time.html">Response time</a></li>
                    <li><a href="https://infra-test.apache.org/./roadmap-for-apache-infrastructure.html">Roadmap for Apache Infrastructure</a></li>
                    <li><a href="https://infra-test.apache.org/./self-hosted-runners.html">Self-hosted runners</a></li>
                    <li><a href="https://infra-test.apache.org/./services-and-tools.html">Services and Tools</a></li>
                    <li><a href="https://infra-test.apache.org/./slack-for-asf-projects.html">Slack for ASF projects</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/ssh.html">Setting up SSH for ASF machines</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/start.html">Committer documentation</a></li>
                    <li><a href="https://infra-test.apache.org/./status-pages.html">Status pages</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/subversion.html">Using Subversion</a></li>
                    <li><a href="https://infra-test.apache.org/./subversion-basics.html">Subversion basics</a></li>
                    <li><a href="https://infra-test.apache.org/./svn-to-git-migration.html">SVN to Git migration</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/svngit2jira.html">Subversion and Git integration with JIRA tickets</a></li>
                    <li><a href="https://infra-test.apache.org/./subversion-and-git-integration-with-jira-tickets.html">Subversion and Git integration with Jira tickets</a></li>
                    <li><a href="https://infra-test.apache.org/./about-the-apache-infrastructure-team.html">About the Apache Infrastructure Team</a></li>
                    <li><a href="https://infra-test.apache.org/./understanding-opensource.html">Understanding Opensource</a></li>
                    <li><a href="https://infra-test.apache.org/./user-documentation-for-project-releases.html">User documentation for project releases</a></li>
                    <li><a href="https://infra-test.apache.org/./committer-ssh-configuration-on-windows.html">Committer SSH configuration on Windows</a></li>
                    <li><a href="https://infra-test.apache.org/./committer-ssh-access.html">Committer SSH Access</a></li>
                    <li><a href="https://infra-test.apache.org/./source-code-repositories-at-apache.html">Source Code Repositories at Apache</a></li>
                    <li><a href="https://infra-test.apache.org/./requesting-a-virtual-machine-for-a-project.html">Requesting a virtual machine for a project</a></li>
                    <li><a href="https://infra-test.apache.org/./project-vm-policy.html">Project VM policy</a></li>
                    <li><a href="https://infra-test.apache.org/./guidelines-for-project-websites.html">Guidelines for project websites</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/website-policy.html">Web Site Guidelines</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/website.html">How To Manage any Apache Project's Website</a></li>
                    <li><a href="https://infra-test.apache.org/./writable-git-repositories.html">Writable Git repositories</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
    <h1 class="entry-title">Using OPIE</h1>
    
    <p>This document covers the setup and use of OPIE (One-time Passwords In Everything). This is 
a mechanism used by the ASF that ensures that your sudo password is not erroneously intercepted
or pasted into the wrong prompt on the remote machine.</p>
<p>Note: FreeBSD uses <code>opiepasswd</code>, Ubuntu VM's use <code>ortpasswd</code> (part of Orthrus) instead.</p>
<p>All users in the wheel group (or in the $machine-sudoers in LDAP) have sudo access.
In order to use sudo, a user <strong>must
configure OPIE</strong> by running <code>opiepasswd</code> on the remote machine.</p>
<h1>Getting an OPIE client for your computer</h1>
<p>Using OPIE requires having an OPIE (S/Key) client on the local (trusted) machine. Some OPIE clients are:</p>
<ul>
<li>Debian/Ubuntu: See <a href="http://ubuntuforums.org/showthread.php?t=1891356">this forum thread</a></li>
<li>Browser-based: <a href="/committer/otp-md5">otp-md5 tool in JavaScript</a></li>
<li>SkeyCalc (Mac OS X)</li>
<li>Orthrus (Unix-like; portable)</li>
<li>FreeBSD: opiekey(1) is part of the base system</li>
<li>donkey (Debian package donkey) Note: Use the '-f' option to set the hash type, usually 'donkey -f md5'</li>
</ul>
<h1>Setting up OPIE:</h1>
<ol>
<li>pick a good passphrase, between 10 and 127 characters long.</li>
<li>never expose it to the net, <strong>never type it on the remote machine</strong></li>
<li>run <code>opiepasswd</code> (or <code>ortpasswd</code>)on the remote machine you wish to get sudo access to.</li>
<li>that will prompt you with an otp challenge, for instance: <code>otp-md5 fo1834 470</code></li>
<li>take that challenge string and run it <strong>locally on your workstation</strong></li>
<li>enter your passphrase at the <strong>local prompt</strong> in 5</li>
<li>repeat 5 and 6 until you are <em>certain</em> you entered your pw correctly</li>
<li>paste the resulting six word response into the challenge prompt in 4. If you get a 20014 error,
    you have entered your password remotely by mistake, please contact infra if so.</li>
<li>have someone add you to the 'wheel' group</li>
<li>run sudo</li>
<li>that will prompt you for an otp challenge</li>
<li>repeat steps 5-8</li>
<li>get root</li>
</ol>
<h1>An example:</h1>
<h2>Remote machine you want to get sudo access to:</h2>
<div class="highlight"><pre><span></span><code><span class="err">foo@test-vm.apache.org# opiepasswd</span>
<span class="err">You need the response from an OTP generator.</span>
<span class="err">New secret pass phrase:</span>
<span class="err">otp-md5 499 fo4576  &lt;-- COPY THIS STRING</span>
<span class="c">Response:</span>
</code></pre></div>

<h2>Local machine:</h2>
<div class="highlight"><pre><span></span><code>$ otp-md5 <span class="m">499</span> fo4576
Using the MD5 algorithm to compute response.
Reminder: Don<span class="err">&#39;</span>t use opiekey from telnet or dial-in sessions.
Enter secret pass phrase: foobarbaztwothirty
WERE GAIL THUG CEIL VIE TWO  &lt;-- COPY THESE WORDS
</code></pre></div>

<h2>Remote machine:</h2>
<div class="highlight"><pre><span></span><code><span class="err">    Response: WERE GAIL THUG CEIL VIE TWO</span>
<span class="err">root@test-vm.apache.org #</span>
</code></pre></div>

<h2>Video Tutorial</h2>
<video controls src="https://home.apache.org/~gmcdonald/using_opie_orthrus.mov"><a href="https://home.apache.org/~gmcdonald/using_opie_orthrus.mov">Setting up Orthrus using SKeyCalc on Mac</a>
</video>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>
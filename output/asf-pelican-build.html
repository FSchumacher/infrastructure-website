<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASF-Pelican build process - Apache Infrastructure</title>
    <link rel="stylesheet" href="/theme/css/foundation.css">
    <link rel="stylesheet" href="/theme/css/app.css">
    <link rel="stylesheet" href="/theme/css/font-awesome.min.css">
    <style type="text/css">
      .frontbox {
        border-radius: 8%;
        border: 1px solid #999; background: #444; color: #EEE; padding: 6px; margin: 3px;
      }
      .frontbox:hover {
        border-top: 4px solid #1583CC;
        margin-top: 0px;
        cursor: pointer;
      }
      .clickable {
	/* height was reduced by 40% */	
	height: 60%;
        width: 30%;
        position: absolute;     
        z-index: 1;
      }
    </style>
    <link rel="stylesheet"
          href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/highlight.min.js"></script>  </head>
  <body style="background: #C9B191;">
    <!-- Menu bar --->
    <div class="row">
      <div class="top-bar" style="padding: 0; margin-bottom: 10px; background: #222; border: 1px solid #DDD; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px;">
        <div class="hide-for-small-only">
          <div class="top-bar-left">
            <ul class="menu" style="background: #222; padding: 0px; line-height: 1; border-bottom-left-radius: 4px;">
              <li class="notable-logo"><a href="/" target="_self" style="padding: 3px; padding-left: 7px;">
                <img style="vertical-align: middle;" src='/theme/images/feather.png' width='18'/><span style="font-size: 1.30rem; color: #1583CC; text-transform: uppercase;">Apache Infrastructure</span></a>
              </li>
            </ul>
          </div>
          <div class="top-bar-right">
            <ul class="dropdown menu horizontal" data-dropdown-menu style="background: #222; font-size: 0.8rem; text-transform: uppercase; padding-top: 5px;">
              <li class="is-dropdown-submenu-parent">
                <a href="#" target="_self" style="padding-left: 7px;">About</a>
                <ul class="menu" style="background: #222; font-size: 0.7rem; text-transform: uppercase; padding-top: 5px; margin-top: 5px;">
                  <li><a href="/team.html">About the team</a></li>
		  <li><a href="https://blogs.apache.org/infra/" target="_blank">The Infra Blog</a></li>	
	          
                </ul>
              </li>
              <li><a href="/policies.html" target="_blank" style="padding-left: 5px;">Policies</a></li>
                           
              <li class="is-dropdown-submenu-parent">
                 <a href="#" target="_self" style="padding-left: 0px;">Services-Tools</a>
                <ul class="menu" style="background: #222; font-size: 0.7rem; text-transform: uppercase; padding-top: 5px; margin-top: 5px;">
		<li><a href="/services.html">Services and Tools</a></li>
                <li><a href="/machines.html" target="_blank" >Machines and Fingerprints</a></li>
                <li><a href="https://blocky.apache.org" target="_blank" >Blocky</a></li>
		<li><a href="https://app.datadoghq.com/account/login?next=%2Finfrastructure" target="_blank" >DataDog</a></li>
		<li><a href="https://whimsy.apache.org/roster/committer/" target="_blank" >Committer Search</a></li>
		
                </ul>
              </li>
              <li><a href="/doc.html" target="_blank" style="padding-left: 5px;">Documentation</a></li>
	       <li class="is-dropdown-submenu-parent">
                 <a href="#" target="_self" style="padding-left: 0px;">Contribute</a>
                <ul class="menu" style="background: #222; font-size: 0.7rem; text-transform: uppercase; padding-top: 5px; margin-top: 5px;">	
		   <li><a href="/infra-volunteer.html">Volunteer with Infra</a></li>
		   <li><a href="/how-to-mirror.html">Become an ASF download mirror</a></li>
			<li><a href="/hosting-external-agent.html">Host a Jenkins or Buildbot agent</a></li>
		 </ul>
	       </li>
	      
              <li><a href="/stats.html" target="_blank" style="padding-left: 5px;">Status</a></li>
              <li><a href="/contact.html" style="padding-left: 5px;"><i class="fa fa-comments" style="color: #FFF; font-size: 0.9rem;"></i>Contact us</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>    
    <!-- bread crumb -->
    <div class="row">
      <div class="large-12 columns" style="font-size: 0.8rem; background-color: rgba(255,255,255,0.75); margin-bottom: 5px;">
        <a href="/">Home</a>
        <i class="fa fa-angle-double-right"></i>
        <a href="/asf-pelican-build.html">
ASF-Pelican build process        </a>
        (<a href="https://github.com/apache/infrastructure-website/tree/master/content/pages/asf-pelican-build.md">edit</a>)
      </div>
    </div>
    
    
    <!-- contents -->
    <div class="row">
      <div class="large-12 columns">
        <div class="callout">
          <h2>
              ASF-Pelican build process
          </h2>
              <p>For websites using the ASf-Pelican template and the <a href="https://docs.getpelican.com/en/stable/" target="_blank">Pelican static site generator</a>, configure the build using the <code>pelicanconf.py</code> settings.</p>
<h2>Pelican theme</h2>
<pre><code class="language-python"># Theme
THEME = './theme/apache'
</code></pre>
<p>See [ASF-Pelican theme][asf-pelican-theme.html] for details about the ASF Theme.</p>
<h2>Plugins</h2>
<p>ASF-Pelican enhances the Pelican environment with plugins. Our environment has its own copy of the <code>asf</code> plugins, and the <code>pelican-build.py</code> script provides <code>pelican-gfm</code>.</p>
<pre><code class="language-python"># Pelican Plugins
# pelican-gfm is installed in the buildbot as part of build_pelican.py. It is an ASF Infra custom plugin.
# other plugins are discoverable and can be installed via pip by mentioning them in requirements.txt
# You can find plugins here: https://github.com/pelican-plugins
# Plugins that are custom for this site are found in PLUGIN_PATHS.
PLUGIN_PATHS = ['./theme/plugins']
PLUGINS = ['asfgenid', 'asfdata', 'pelican-gfm', 'asfreader']
</code></pre>
<ol>
<li><a href="#data-model">Data Model</a>. The <code>asfdata.py</code> plugin builds a metadata model that is shared with every page.</li>
<li><a href="#pelican-gfm">GFM Content</a>. The <code>pelican-gfm</code> plugin reads <strong>.md</strong>, <strong>.markdown</strong>, <strong>.mkd</strong>, and <strong>.mdown</strong> files and converts the GFM Markdown into HTML.</li>
<li><a href="#ezmd-reader">EZMD Content</a>. The <code>asfreader.py</code> plugin reads <strong>.ezmd</strong> files, injects data, translates ezt, and converts the GFM Markdown into HTML.</li>
<li><a href="#generate-id">Generate ID</a>. The <code>asfgenid.py</code> plugin performs a number of enhancements to the HTML.</li>
</ol>
<p>See [ASF-Pelican build process][asf-pelican-build.html] for the steps signaled. See [plugins][asf-pelican-plugins.html] for the Python code.</p>
<h2>Tree structure</h2>
<p>Pages and static content are stored in the same tree. Generated content is output with the same relative path, except with an html extension.
These are the necessary settings:</p>
<pre><code class="language-python">PATH = 'content'
# Save pages using full directory preservation
PAGE_PATHS = ['.']
# Path with no extension
PATH_METADATA = '(?P&lt;path_no_ext&gt;.*)\..*'
# We are not slugifying any pages
ARTICLE_URL = ARTICLE_SAVE_AS = PAGE_URL = PAGE_SAVE_AS = '{path_no_ext}.html'
# We want to serve our static files mixed with content
STATIC_PATHS = ['.']
# we want any html to be served as-is
READERS = {'html': None}
# ignore README.md files in the content tree and the interviews and include folders
IGNORE_FILES = ['README.md','interviews','include']
</code></pre>
<h1>Process</h1>
<p>Pelican uses <a href="https://docs.getpelican.com/en/latest/plugins.html#list-of-signals" target="_blank">signals</a> as it goes through the process of reading and generating content. It processes pages in no particular order.</p>
<p>Our plugins provide the following activity:</p>
<table>
<thead>
<tr>
<th>Pelican Signal</th>
<th>Step</th>
<th align="center"><a href="#pelican-gfm">GFM Content</a></th>
<th align="center"><a href="#ezmd-reader">EZMD Content</a></th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Initialization</td>
<td><a href="#data-model">Data Model</a></td>
<td align="center"></td>
<td align="center"></td>
<td>Read data sources</td>
</tr>
<tr>
<td>Reader</td>
<td>Class</td>
<td align="center"><a href="#pelican-gfm">GFMReader</a></td>
<td align="center"><a href="#ezmd-reader">ASFReader(GFMReader)</a></td>
<td>Pelican Reader class</td>
</tr>
<tr>
<td></td>
<td><a href="#read-source">Read</a></td>
<td align="center">read_source</td>
<td align="center">super.read_source</td>
<td>Read page source and metadata</td>
</tr>
<tr>
<td></td>
<td><a href="#model-metadata">Model Metadata</a></td>
<td align="center"></td>
<td align="center">add_data</td>
<td>Add asf data to the model and expand any <code>[{ reference }]</code></td>
</tr>
<tr>
<td></td>
<td><a href="#ezt-translation">Translate</a></td>
<td align="center"></td>
<td align="center">ezt</td>
<td>ezt template translation</td>
</tr>
<tr>
<td></td>
<td><a href="#render-gfm">Render GFM</a></td>
<td align="center">render</td>
<td align="center">super.render</td>
<td>Render GFM/HTML into HTML</td>
</tr>
<tr>
<td>Content</td>
<td><a href="#generate-id">Generate ID</a></td>
<td align="center">generate_id</td>
<td align="center">generate_id</td>
<td>Perform ASF specific HTML enhancements</td>
</tr>
<tr>
<td>Generator</td>
<td><a href="../theme/apache/templates/.">Template</a></td>
<td align="center">translate</td>
<td align="center">translate</td>
<td>Create output HTML by pushing the generated content and metadata through the theme's templates</td>
</tr></tbody></table>
<p>See [local builds][asf-pelican-local.html] for how to install ASF-Pelican on your system.</p>
<h2>Data model</h2>
<p><strong>ezmd</strong> templates use a shared data model to generate content. There are three types of data:</p>
<table>
<thead>
<tr>
<th>When refereced</th>
<th>Data type</th>
</tr>
</thead>
<tbody>
<tr>
<td>EZMD Reader, Content, Generator</td>
<td>Constants - either integer or string values</td>
</tr>
<tr>
<td>EZMD Reader</td>
<td>Sequences - arrays of objects with attributes where an attribute may be another sequence</td>
</tr>
<tr>
<td>EZMD Reader</td>
<td>Dictionaries - key-value maps where the value may be another dictionary</td>
</tr></tbody></table>
<p>The constants are also available to the <code>asfgenid.py</code> plugin and the [theme's templates][asf-pelican-theme.html].</p>
<p>There are examples of how to <a href="#model-metadata">inject shared metadata</a> below. See the [metadata model][asf-pelican-data.html] for how <code>asfdata.py</code> works to populate the shared metadata.</p>
<h2>Read source</h2>
<p>The systems uses the <code>read_source</code> method to open a file and convert it into a metadata dictionary and text.</p>
<p>Example:</p>
<pre><code class="language-md">Title: ASF Export Classifications and Source Links
license: https://www.apache.org/licenses/LICENSE-2.0
asf_headings: False

#### ASF Project
...
</code></pre>
<p>The first three lines specify three <code>metadata</code> key-value pairs.
There is a blank line and the rest is the <code>text</code>.</p>
<p>Code from <code>pelican-gfm</code> with some parts elided.</p>
<pre><code class="language-python">    def read_source(self, source_path):
        &quot;Read metadata and content from the source.&quot;
	...
	# Fetch the source content, with a few appropriate tweaks
        with pelican.utils.pelican_open(source_path) as text:

            # Extract the metadata from the header of the text
            lines = text.splitlines()
            for i in range(len(lines)):
                line = lines[i]
                match = GFMReader.RE_METADATA.match(line)
                if match:
                    name = match.group(1).strip().lower()
		    ...
                    metadata[name] = value
                elif not line.strip():
                    # blank line
                    continue
                else:
                    # reached actual content
                    break
	    ...
            # Reassemble content, minus the metadata
            text = '\n'.join(lines[i:])

            return text, metadata
</code></pre>
<h2>Model Metadata <a id="ezmd"></a></h2>
<p>In <code>asfreader.py</code> we extend EZT syntax to do metadata substitution prior to EZT translation. This allows for a more natural and direct representation than with EZT sequences.</p>
<h3>Examples</h3>
<pre><code class="language-md">|  |  |  |
|-----------|-----------|-------------|
| [{ board[0].name }] | [{ board[1].name }] | [{ board[2].name }] |
| [{ board[3].name }] | [{ board[4].name }] | [{ board[5].name }] |
| [{ board[6].name }] | [{ board[7].name }] | [{ board[8].name }] |
</code></pre>
<pre><code class="language-md">| Office    | Individual  |
|-----------|-------------|
| Board Chair |  [{ ci[boardchair][roster] }] |
| Vice Chair |  [{ ci[vicechair][roster] }] |
| President |  [{ ci[president][roster] }] |
| Exec. V.P |  [{ ci[execvp][roster] }] |
| [[]Treasurer](https://treasurer.apache.org/) |  [{ ci[treasurer][roster] }] |
| Assistant Treasurer |  [{ ci[assistanttreasurer][roster] }] |
| Secretary |  [{ ci[secretary][roster] }] |
| Assistant Secretary |  [{ ci[assistantsecretary][roster] }] |
| V.P., [[]Legal Affairs](/legal/) |  [{ ci[legal][chair] }] |
| Assistant V.P., [[]Legal Affairs](/legal/) |  [{ ci[assistantvplegalaffairs][roster] }] |
</code></pre>
<pre><code class="language-md">- All volunteer community
- [{ code_lines }]+ lines of code in&amp;nbsp;stewardship
- [{ code_changed }]+ lines of code&amp;nbsp;changed
- [{ code_commits }]+ code commits
- [{ asf_members }] individual ASF&amp;nbsp;Members
- [{ asf_committers }]+ Apache Committers
- [{ asf_contributors }]+ code contributors
- [{ asf_people }]+ people involved in our&amp;nbsp;communities
</code></pre>
<h3>EZMD Reader</h3>
<p>The <code>asfreader.py</code> plugin is responsible for <a href="#read-source">reading the source</a>, adding metadata, <a href="#ezt-translation">ezt translation</a>, and <a href="#render-gfm">rendering GFM</a></p>
<pre><code class="language-python">    def add_data(self, text, metadata):
        &quot;Mix in ASF data as metadata&quot;

        asf_metadata = self.settings.get('ASF_DATA', { }).get('metadata')
        if asf_metadata:
            metadata.update(asf_metadata)
            # insert any direct references
            m = 1
            while m:
                m = METADATA_RE.search(text)
                if m:
                    this_data = m.group(1).strip()
                    format_string = '{{{0}}}'.format(this_data)
                    try:
                        new_string = format_string.format(**metadata)
                        print(f'{{{{{m.group(1)}}}}} -&gt; {new_string}')
                    except Exception:
                        # the data expression was not found
                        new_string = format_string
                        print(f'{{{{{m.group(1)}}}}} is not found')
                    text = re.sub(METADATA_RE, new_string, text, count=1)
        return text, metadata
</code></pre>
<h2>EZT Translation</h2>
<p><strong>ezmd</strong> page files are <a href="https://github.com/gstein/ezt">ezt</a> templates that create Markdown and HTML output. See <a href="https://github.com/gstein/ezt/blob/wiki/Syntax.md">EZT Syntax</a> for the directives.</p>
<h3>EZT Examples</h3>
<p>Project list:</p>
<pre><code class="language-md">| Office    | Individual  |
|-----------|-------------|[for projects]
| V.P., [if-any projects.site][[][end]Apache [projects.display_name][if-any projects.site]]([projects.site])[end] | [projects.chair] |[end]
</code></pre>
<p>Featured projects:</p>
<pre><code class="language-html">[for featured_projs]&lt;li [if-index featured_projs first]class=&quot;active&quot;[end]&gt;
     &lt;a href=&quot;#[featured_projs.key_id]&quot; data-toggle=&quot;tab&quot;&gt;[featured_projs.display_name]&lt;/a&gt;
&lt;/li&gt;[end]
</code></pre>
<p>Insert a file as-is into the output:</p>
<pre><code class="language-md">Title: Apache Download Mirrors

[insertfile &quot;include/closer.ezt&quot;]
</code></pre>
<h3>EZT Code</h3>
<p>Code from <code>asfreader.py</code></p>
<pre><code class="language-python">            # prepare text as an ezt template
            # compress_whitespace=0 is required as blank lines and indentation have meaning in markdown
            template = ezt.Template(compress_whitespace=0)
            reader = ASFTemplateReader(source_path, text)
            template.parse(reader, base_format=ezt.FORMAT_HTML)
            assert template
            # generate content from ezt template with metadata
            fp = io.StringIO()
            template.generate(fp, metadata)
</code></pre>
<h2>Render GFM</h2>
<p>Content is in <a href="gfm.html">GitHub Flavored Markdown</a> (GFM).</p>
<p>ASF-Pelican uses a version of <a href="https://github.com/github/cmark-gfm" target="_blank">cmark-gfm</a> by <a href="https://github.blog/2017-03-14-a-formal-spec-for-github-markdown/" target="_blank">GitHub</a> through the <code>pelican-gfm</code> plugin created by Apache Infra.</p>
<ul>
<li>
<p><a href="https://guides.github.com/features/mastering-markdown/" target="_blank">Mastering Markdown</a></p>
</li>
<li>
<p><a href="https://github.github.com/gfm/">Detailed Specification</a> with many examples</p>
</li>
<li>
<p>Many projects used the Apache CMS for their websites. Here are some differences from its <code>markdown.pl</code>.</p>
<ul>
<li>
<p><a href="https://github.github.com/gfm/#html-block">HTML Blocks</a></p>
<ul>
<li>Make sure the first line of your html block starts in column one.</li>
<li>A blank line terminates an html block
<ul>
<li><a href="https://github.github.com/gfm/#example-139">Exception</a> to this rule for <code>style</code>, <code>pre</code>, and <code>script</code>.</li>
</ul>
</li>
<li><a href="https://github.github.com/gfm/#example-122">Markdown content within an HTML block</a></li>
</ul>
</li>
<li>
<p><a href="https://github.github.com/gfm/#autolink">Autolinks</a></p>
<ul>
<li><a href="https://github.github.com/gfm/#extended-www-autolink">www</a></li>
<li><a href="https://github.github.com/gfm/#extended-url-autolink">url</a></li>
<li><a href="https://github.github.com/gfm/#extended-email-autolink">email</a></li>
</ul>
</li>
<li>
<p><a href="https://github.github.com/gfm/#disallowed-raw-html-extension-">Disallowed html</a> the tagfilter extension disables certain html. The asfgenid plugin reenables <code>script</code>, <code>style</code>, and <code>iframe</code> html.</p>
</li>
</ul>
</li>
<li>
<p><a href="https://sindresorhus.com/github-markdown-css/">Examples</a></p>
</li>
</ul>
<h3>Pelican GFM</h3>
<p>The <code>pelican-gfm</code> plugin <a href="#read-source">reads</a> the content file and renders it to HTML.</p>
<p>From <code>asfreader.py</code>:</p>
<pre><code class="language-python">            # Render the markdown into HTML
            content = super().render(fp.getvalue().encode('utf-8')).decode('utf-8')
            assert content
</code></pre>
<p>From <code>pelican-gfm</code>:</p>
<pre><code class="language-python">    def render(self, text):
      &quot;Use cmark-gfm to render the Markdown into an HTML fragment.&quot;

      parser = F_cmark_parser_new(OPTS)
      assert parser
      for name in EXTENSIONS:
        ext = F_cmark_find_syntax_extension(name.encode('utf-8'))
        assert ext
        rv = F_cmark_parser_attach_syntax_extension(parser, ext)
        assert rv
      exts = F_cmark_parser_get_syntax_extensions(parser)
      F_cmark_parser_feed(parser, text, len(text))
      doc = F_cmark_parser_finish(parser)
      assert doc

      output = F_cmark_render_html(doc, OPTS, exts)

      F_cmark_parser_free(parser)
      F_cmark_node_free(doc)

      return output
</code></pre>
<h2>Generate ID</h2>
<p>We use the <code>asfgenid</code> plugin to perform modifications on the generated content that mimics the markdown extensions in the Apache CMS.
Many of these ASF-specific enhancements are controlled in <a href="../pelicanconf.py">pelican settings</a> in the <code>ASF_GENID</code> dictionary.</p>
<table>
<thead>
<tr>
<th>ASF_GENID key</th>
<th align="center">default</th>
<th>process</th>
<th>page override</th>
</tr>
</thead>
<tbody>
<tr>
<td>unsafe_tags</td>
<td align="center">True</td>
<td>fix up script, style, and iframe HTML tags that the GFM autofilter extension marks as unsafe</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td align="center">-</td>
<td>convert HTML into beautiful soup</td>
<td></td>
</tr>
<tr>
<td>metadata</td>
<td align="center">True</td>
<td><code>{{ metadata }}</code> include data in the HTML</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td align="center">True</td>
<td>inventory of all ID attributes; duplicates are invalid</td>
<td></td>
</tr>
<tr>
<td>elements</td>
<td align="center">True</td>
<td>find all <code>{#id}</code> and <code>{.class}</code> texts and assign attributes</td>
<td></td>
</tr>
<tr>
<td>headings</td>
<td align="center">True</td>
<td>assign IDs to all headings w/o IDs already present or assigned with <code>{#id}</code> text</td>
<td>asf_headings</td>
</tr>
<tr>
<td>headings_re</td>
<td align="center"><code>r'^h[1-6]'</code></td>
<td>regex for finding headings that require IDs</td>
<td></td>
</tr>
<tr>
<td>tables</td>
<td align="center">True</td>
<td>tables with a class attribute are assgned <code>class=table</code></td>
<td></td>
</tr>
<tr>
<td>toc</td>
<td align="center">True</td>
<td>generate a table of contents if [TOC] is found. If this is set to False then the <code>toc.py</code> plugin may be used.</td>
<td></td>
</tr>
<tr>
<td>toc_headers</td>
<td align="center"><code>r'h[1-6]'</code></td>
<td>headings to include in the [TOC]</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td align="center">-</td>
<td>convert beautiful soup back into HTML.</td>
<td></td>
</tr></tbody></table>
<pre><code class="language-python"># Configure the asfgenid plugin
ASF_GENID = {
    'metadata': True,
    'elements': True,
    'headings': True,
    'headings_re': r'^h[1-4]',
    'permalinks': True,
    'toc': True,
    'toc_headers': r&quot;h[1-4]&quot;,
    'tables': True,
    'debug': False
}
</code></pre>
<h3>Element examples</h3>
<p>Set the heading ID and permalink to <code>#what</code></p>
<pre><code class="language-md">## What is the Apache Software Foundation?  {#what}

The Apache Software Foundation (ASF) is a non-profit 501(c)(3) corporation,
incorporated in Delaware, USA, in June of 1999. The ASF is a natural
outgrowth of The Apache Group, which
formed in 1995 to develop the Apache HTTP Server.
</code></pre>
<p>Set the class to display an image to <code>float-right</code></p>
<pre><code class="language-md">![Logo](images/logo.svg) {.float-right}
</code></pre>
<p>An HTML fragment is also feasible for a similar purpose</p>
<pre><code class="language-html">&lt;div class=&quot;.pull-right&quot; style=&quot;float:right; border-style:dotted; width:200px; padding:5px; margin:5px&quot;&gt;

SEE INSTEAD: [Trademark Resources Site Map][resources].

&lt;/div&gt;
</code></pre>
<h3>Heading code</h3>
<p>Code from <code>asfgenid.py</code> uses <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/index.html?highlight=javascript#">BeautifulSoup 4</a> to manipulate the rendered HTML. Here is an example:</p>
<pre><code class="language-python"># from Apache CMS markdown/extensions/headerid.py - slugify in the same way as the Apache CMS
def slugify(value, separator):
    &quot;&quot;&quot; Slugify a string, to make it URL friendly. &quot;&quot;&quot;
    value = unicodedata.normalize('NFKD', value).encode('ascii', 'ignore')
    value = re.sub('[^\\w\\s-]', '', value.decode('ascii')).strip().lower()
    return re.sub('[%s\\s]+' % separator, separator, value)

...

# append a permalink
def permalink(soup, mod_element):
    new_tag = soup.new_tag('a', href='#' + mod_element['id'])
    new_tag['class'] = 'headerlink'
    new_tag['title'] = 'Permalink'
    new_tag.string = LINK_CHAR
    mod_element.append(new_tag)

...

# generate ID for a heading
def headingid_transform(ids, soup, tag, permalinks, perma_set):
    new_string = tag.string
    if not new_string:
        # roll up strings if no immediate string
        new_string = tag.find_all(
            text=lambda t: not isinstance(t, Comment),
            recursive=True)
        new_string = ''.join(new_string)

    # don't have an id create it from text
    new_id = slugify(new_string, '-')
    tag['id'] = unique(new_id, ids)
    if permalinks:
        permalink(soup, tag)
        # inform if there is a duplicate permalink
        unique(tag['id'], perma_set)

...

    # step 6 - find all headings w/o ids already present or assigned with {#id} text
    if asf_headings == 'True':
        if asf_genid['debug']:
            print(f'headings: {content.relative_source_path}')
        # Find heading tags
        HEADING_RE = re.compile(asf_genid['headings_re'])
        for tag in soup.findAll(HEADING_RE, id=False):
            headingid_transform(ids, soup, tag, asf_genid['permalinks'], permalinks)
</code></pre>

        </div>
      </div>
    </div>    
    <!-- footer -->
    <div class="row">
      <div class="large-12 medium-12 columns">
        <p style="font-style: italic; font-size: 0.8rem; text-align: center;">
          Copyright 2022, <a href="https://www.apache.org/">The Apache Software Foundation</a>, Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.<br/>
          Apache&reg; and the Apache feather logo are trademarks of The Apache Software Foundation...
        </p>
      </div>
    </div>    
    <script src="/theme/js/vendor/jquery.js"></script>
    <script src="/theme/js/vendor/what-input.js"></script>
    <script src="/theme/js/vendor/foundation.js"></script>
    <script src="/theme/js/app.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscribe to Apache Software Foundation infrastructure events - Apache Infrastructure</title>
    <link rel="stylesheet" href="/theme/css/foundation.css">
    <link rel="stylesheet" href="/theme/css/app.css">
    <link rel="stylesheet" href="/theme/css/font-awesome.min.css">
    <style type="text/css">
      .frontbox {
        border-radius: 8%;
        border: 1px solid #999; background: #444; color: #EEE; padding: 6px; margin: 3px;
      }
      .frontbox:hover {
        border-top: 4px solid #1583CC;
        margin-top: 0px;
        cursor: pointer;
      }
      .clickable {
	/* height was reduced by 40% */	
	height: 60%;
        width: 30%;
        position: absolute;     
        z-index: 1;
      }
    </style>
    <link rel="stylesheet"
          href="/theme/highlight/default.min.css">
    <script src="/theme/highlight/highlight.min.js"></script>  </head>
  <body style="background: #C1C1C1;">
    <!-- Menu bar --->
    <div class="row">
      <div class="top-bar" style="padding: 0; margin-bottom: 10px; background: #222; border: 1px solid #DDD; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px;">
        <div class="hide-for-small-only">
          <div class="top-bar-left">
            <ul class="menu" style="background: #222; padding: 0px; line-height: 1; border-bottom-left-radius: 4px;">
              <li class="notable-logo"><a href="/" target="_self" style="padding: 3px; padding-left: 7px;">
                <img style="vertical-align: middle;" src='/theme/images/feather.png' width='18'/><span style="font-size: 1.30rem; color: #1583CC; text-transform: uppercase;">Apache Infrastructure</span></a>
              </li>
            </ul>
          </div>
          <div class="top-bar-right">
            <ul class="dropdown menu horizontal" data-dropdown-menu style="background: #222; font-size: 0.8rem; text-transform: uppercase; padding-top: 5px;">
              <li class="is-dropdown-submenu-parent">
                <a href="#" target="_self" style="padding-left: 7px;">About</a>
                <ul class="menu" style="background: #222; font-size: 0.7rem; text-transform: uppercase; padding-top: 5px; margin-top: 5px;">
                  <li><a href="/team.html">About the team</a></li>
		  <li><a href="https://blogs.apache.org/infra/" target="_blank">The Infra Blog</a></li>	
	          
                </ul>
              </li>
              <li><a href="/policies.html" target="_blank" style="padding-left: 5px;">Policies</a></li>
                           
              <li class="is-dropdown-submenu-parent">
                 <a href="#" target="_self" style="padding-left: 0px;">Services-Tools</a>
                <ul class="menu" style="background: #222; font-size: 0.7rem; text-transform: uppercase; padding-top: 5px; margin-top: 5px;">
		<li><a href="/services.html">Services and Tools</a></li>
                <li><a href="/machines.html" target="_blank" >Machines and Fingerprints</a></li>
                <li><a href="https://blocky.apache.org" target="_blank" >Blocky</a></li>
		<li><a href="https://app.datadoghq.com/account/login?next=%2Finfrastructure" target="_blank" >DataDog</a></li>
		<li><a href="https://whimsy.apache.org/roster/committer/" target="_blank" >Committer Search</a></li>
		
                </ul>
              </li>
              <li><a href="/doc.html" target="_blank" style="padding-left: 5px;">Documentation</a></li>
	       <li class="is-dropdown-submenu-parent">
                 <a href="#" target="_self" style="padding-left: 0px;">Contribute</a>
                <ul class="menu" style="background: #222; font-size: 0.7rem; text-transform: uppercase; padding-top: 5px; margin-top: 5px;">	
		   <li><a href="/infra-volunteer.html">Volunteer with Infra</a></li>
		   <li><a href="/how-to-mirror.html">Become an ASF download mirror</a></li>
			<li><a href="/hosting-external-agent.html">Host a Jenkins or Buildbot agent</a></li>
		 </ul>
	       </li>
	      
              <li><a href="/stats.html" target="_blank" style="padding-left: 5px;">Status</a></li>
              <li><a href="/contact.html" style="padding-left: 5px;"><i class="fa fa-comments" style="color: #FFF; font-size: 0.9rem;"></i>Contact us</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>    
    <!-- bread crumb -->
    <div class="row">
      <div class="large-12 columns" style="font-size: 0.8rem; background-color: rgba(255,255,255,0.75); margin-bottom: 5px;">
        <a href="/">Home</a>
        <i class="fa fa-angle-double-right"></i>
        <a href="/pypubsub.html">
Subscribe to Apache Software Foundation infrastructure events        </a>
        (<a href="https://github.com/apache/infrastructure-website/tree/master/content/pages/pypubsub.md">edit</a>)
      </div>
    </div>
    
    
    <!-- contents -->
    <div class="row">
      <div class="large-12 columns">
        <div class="callout">
          <h2>
              Subscribe to Apache Software Foundation infrastructure events
          </h2>
              <p>The ASF employs a plain-text publisher/subscriber service called <strong>PyPubSub</strong> at <code>pubsub.apache.org:2069</code>, which lists most events that happen within the Foundation's infrastructure.</p>
<p>Currently, the service streams the following events:</p>
<ul>
<li>Subversion commits</li>
<li>Git commits and pushes</li>
<li>Emails to publicly archived lists</li>
<li>JIRA updates</li>
<li>Pull Requests and Issues from GitHub</li>
<li>Staging and publishing notifications sent via our <a href="https://s.apache.org/asfyaml">.asf.yaml</a> offering.</li>
</ul>
<p>Events are delivered as JSON objects in a <a href="https://en.wikipedia.org/wiki/Chunked_transfer_encoding" target="_blank">chunked response stream</a>, with each new chunk being either an event payload or a keep-alive ping.</p>
<h2>How to subscribe</h2>
<p>Subscribers can pick one or multiple topics to subscribe to, with more specific subscriptions getting fewer, but more specific, event payloads. Construct subscriptions in the form of: <code>http://pubsub.apache.org:2069/topics/go/here</code>, and separate the topics you want to subscribe to with forward slashes.</p>
<p>The service returns events that match <em>all</em> of the topics you are subscribed to.
To subscribe to multiple topic batches in an OR'ed way, you may use a comma to separate your batches of topics.</p>
<p>Some examples:</p>
<ul>
<li>To subscribe to all svn commits; <code>http://pubsub.apache.org:2069/svn/commit</code></li>
<li>To subscribe to all git commits; <code>http://pubsub.apache.org:2069/git/commit</code></li>
<li>To subscribe to all git events (push+commit) for whimsy.git; <code>http://pubsub.apache.org:2069/git/whimsy</code></li>
<li>To subscribe to all <code>netbeans.apache.org</code> emails: <code>http://pubsub.apache.org:2069/email/netbeans.apache.org</code></li>
<li>To subscribe to PRs opened against <code>beam-foo.git</code>: <code>http://pubsub.apache.org:2069/github/beam-foo.git/pr</code></li>
<li>To subscribe to all commits, both Subversion and git: <code>http://pubsub.apache.org:2069/commit</code></li>
<li>To subscribe to all JIRA events for the HADOOP JIRA instance: <code>http://pubsub.apache.org:2069/jira/HADOOP</code></li>
<li>To subscribe to <em>both</em> JIRA and email streams for tomcat in one go: <code>http://pubsub.apache.org:2069/jira/TOMCAT,email/tomcat.apache.org</code></li>
</ul>
<p>Public SVN repo topics consist of 'svn', the first one or two path segments after the /repo/ in the URL, and 'commit'.
For example, changes to the repository <code>https://dist.apache.org/repos/dist/release/</code> have the topics <code>svn/dist/release/commit</code>.
A commit that involves changes to both <code>dist/release</code> and <code>dist/dev</code> has the topics <code>svn/dist/commit</code>.
Note that <code>svn/dist/release/commit</code> will not match, because the topics in the response do not include <code>release</code>.</p>
<p>Private SVN repos topics are constructed in the same way, but have an additional 'private' topic.
For example <code>https://pubsub.apache.org:2070/private/svn/private/committers/commit</code> returns commits for
<code>https://svn.apache.org/repos/private/committers/board/</code></p>
<h2>Event payload examples</h2>
<p>Pings are simple objects like this:</p>
<pre><code class="language-json">{&quot;stillalive&quot;: 1583973410.9620552}
</code></pre>
<p>An example of a real event payload, in this case a git commit, could be (emails redacted in this example):</p>
<pre><code class="language-json">{
	&quot;commit&quot;: {
		&quot;body&quot;: &quot;[maven-release-plugin] prepare for next development iteration\n&quot;,
		&quot;committer&quot;: &quot;sblackmon &lt;s...@apache.org&gt;&quot;,
		&quot;hash&quot;: &quot;8e6f956&quot;,
		&quot;log&quot;: &quot;[maven-release-plugin] prepare for next development iteration&quot;,
		&quot;repository&quot;: &quot;git&quot;,
		&quot;sha&quot;: &quot;8e6f956c2eda06ca9debf21634cedcecc96293ff&quot;,
		&quot;author&quot;: &quot;sblackmon&quot;,
		&quot;files&quot;: [&quot;pom.xml&quot;, &quot;streams-cli/pom.xml&quot;, &quot;streams-components/pom.xml&quot;],
		&quot;server&quot;: &quot;gitbox&quot;,
		&quot;project&quot;: &quot;streams&quot;,
		&quot;autopublish&quot;: false,
		&quot;date&quot;: &quot;Wed Mar 11 19:25:06 2020 -0500&quot;,
		&quot;commited&quot;: &quot;Wed Mar 11 19:25:06 2020 -0500&quot;,
		&quot;subject&quot;: &quot;[maven-release-plugin] prepare for next development iteration&quot;,
		&quot;ref&quot;: &quot;refs/heads/master&quot;,
		&quot;email&quot;: &quot;s...@apache.org&quot;,
		&quot;authored&quot;: &quot;Wed Mar 11 19:25:06 2020 -0500&quot;,
		&quot;ref_names&quot;: &quot;&quot;
	},
	&quot;pubsub_topics&quot;: [&quot;git&quot;, &quot;streams&quot;, &quot;commit&quot;],
	&quot;pubsub_path&quot;: &quot;/git/streams/commit&quot;
}
</code></pre>
<p>Payloads vary depending on what they represent, so check both what sub-objects are present in the payload and the <code>pubsub_path</code> variable, which will show the full payload event path and explain which type is being sent.</p>
<h2>Try it yourself</h2>
<p>To try it out and take a look at the event stream, use <a href="https://en.wikipedia.org/wiki/CURL">cURL</a> in your terminal:</p>
<pre><code class="language-bash">curl http://pubsub.apache.org:2069/git/commit
</code></pre>
<br/>
<p>A secure version also exists on port 2070, for use with authenticated event streams:</p>
<pre><code class="language-bash">curl https://pubsub.apache.org:2070/git/commit
</code></pre>
<p>Please note that due to limitations in our TLS terminator, payloads larger than 64kb are split into 64kb chunks on
port 2070. If you are using port 2070, you should ensure that the data you receive is terminated with a newline (\n),
or continue fetching data till you hit a chunk terminated with a newline.</p>
<h2>Using PyPubSub in programming</h2>
<h3>Using PyPubSub with Python</h3>
<p>You can listen for and react to payloads in Python using the <a href="https://pypi.org/project/asfpy/">asfpy</a> pip package:</p>
<pre><code class="language-python">import asfpy.pubsub

def process_event(payload):
   print(&quot;Got an event from PyPubSub!&quot;)
   ...

def main():
    pubsub = asfpy.pubsub.Listener('http://pubsub.apache.org:2069/')
    pubsub.attach(process_event, raw=True)

</code></pre>
<h3>Using PyPubSub with node.js</h3>
<p>This sample snippet lets you use <code>node.js</code> for listening for and processing pubsub events:</p>
<pre><code class="language-javascript">const http = require(&quot;http&quot;);
const https = require(&quot;https&quot;);

class PyPubSub {
    constructor(url) {
        this.url = url;
        this.getter = url.match(/^https/i) ? https : http;
    }

    attach(func) {
        this.getter.get(this.url, res =&gt; {
            res.setEncoding(&quot;utf8&quot;);
            let body = '';
            res.on(&quot;data&quot;, data =&gt; {
	        // Be mindful of proxies that split pubsub chunks into smaller ones,
		// only load the JSON blob once we hit a newline (\n)
                body += data;
                if (data.endsWith(&quot;\n&quot;)) {
                    let payload = JSON.parse(body);
                    body = '';
                    func(payload);
                }
              });
        });
    }
}


// Test
function process(payload) {
    // ping-back?
    if (payload.stillalive) {
        console.log(&quot;Got a ping-back&quot;);
    // Actual payload? process it!
    } else {
        console.log(&quot;Got a payload from PyPubSub!&quot;);
        console.log(payload);
    }
}

const pps = new PyPubSub('http://pubsub.apache.org:2069/');
pps.attach(process);
</code></pre>
<h3>Using PyPubSub with Ruby</h3>
<p>This sample lets you connect to our pubsub service via Ruby:</p>
<pre><code class="language-ruby">require 'net/http'
require 'json'
require 'thread'

pubsub_URL = 'https://pubsub.apache.org:2070/'

def do_stuff_with(event)
  print(&quot;Got a pubsub event!:\n&quot;)
  print(event)
  print(&quot;\n&quot;)
end

def listen(url)
  ps_thread = Thread.new do
    begin
      uri = URI.parse(url)
      Net::HTTP.start(uri.host, uri.port, :use_ssl =&gt; url.match(/^https:/) ? true : false) do |http|
        request = Net::HTTP::Get.new uri.request_uri
        http.request request do |response|
          body = ''
          response.read_body do |chunk|
            body += chunk
	    # All chunks are terminated with \n. Since 2070 can split events into 64kb sub-chunks
	    # we wait till we have gotten a newline, before trying to parse the JSON.
            if chunk.end_with? &quot;\n&quot;
              event = JSON.parse(body.chomp)
              body = ''
              if event['stillalive']  # pingback
                print(&quot;ping? PONG!\n&quot;)
              else
                do_stuff_with(event)
              end
            end
          end
        end
      end
    rescue Errno::ECONNREFUSED =&gt; e
      restartable = true
      STDERR.puts e
      sleep 3
    rescue Exception =&gt; e
      STDERR.puts e
      STDERR.puts e.backtrace
    end
  end
  return ps_thread
end

begin
  ps_thread = listen(pubsub_URL)
  print(&quot;Pubsub thread started, waiting for results...\n&quot;)
  while ps_thread.alive?
    sleep 10
  end
end
</code></pre>
<h2>Want to know more? Have questions?</h2>
<p>To learn more, or just get some questions answered, please contact us at <code>users@infra.apache.org</code>, and we'll try our best to help you out.</p>
<h2>Acknowledgements</h2>
<p>PyPubSub is based on <a href="https://paul.querna.org/articles/2010/10/22/evolution-of-apaches-websites/">SvnPubSub</a>
and <a href="https://www.apache.org/dev/gitpubsub.html">gitpubsub</a>. We wish to thank the Subversion project for building the precursor to this service.</p>

        </div>
      </div>
    </div>    
    <!-- footer -->
    <div class="row">
      <div class="large-12 medium-12 columns">
        <p style="font-style: italic; font-size: 0.8rem; text-align: center;">
          Copyright 2022, <a href="https://www.apache.org/">The Apache Software Foundation</a>, Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.<br/>
          Apache&reg; and the Apache feather logo are trademarks of The Apache Software Foundation...
        </p>
      </div>
    </div>    
    <script src="/theme/js/vendor/jquery.js"></script>
    <script src="/theme/js/vendor/what-input.js"></script>
    <script src="/theme/js/vendor/foundation.js"></script>
    <script src="/theme/js/app.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />
        <title>Using the Digicert code signing service</title>
        <link rel="stylesheet" href="https://infra-test.apache.org/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://infra-test.apache.org/">Apache Infrastructure</a></h1>
                <nav><ul>
                    <li><a href="https://infra-test.apache.org/./apache-and-github.html">Apache and GitHub</a></li>
                    <li><a href="https://infra-test.apache.org/./application-upgrades-policy-and-workflow.html">Application upgrades policy and workflow</a></li>
                    <li><a href="https://infra-test.apache.org/./distributing-through-the-apple-developer-program.html">Distributing through the Apple Developer Program</a></li>
                    <li><a href="https://infra-test.apache.org/./applying-the-apache-license-version-20.html">Applying the Apache license, version 2.0</a></li>
                    <li><a href="https://infra-test.apache.org/./asf-pelican-feature-branches.html">ASF Pelican feature branches</a></li>
                    <li><a href="https://infra-test.apache.org/./asf-pelican-data-model.html">ASF Pelican data model</a></li>
                    <li><a href="https://infra-test.apache.org/./asf-pelican-getting-started-guide.html">ASF-Pelican getting-started guide</a></li>
                    <li><a href="https://infra-test.apache.org/./local-pelican-builds.html">Local Pelican builds</a></li>
                    <li><a href="https://infra-test.apache.org/./asf-pelican-plugins.html">ASF Pelican plugins</a></li>
                    <li><a href="https://infra-test.apache.org/./apache-theme-for-asf-pelican.html">Apache Theme for ASF Pelican</a></li>
                    <li><a href="https://infra-test.apache.org/./asf-pelican.html">ASF-Pelican</a></li>
                    <li><a href="https://infra-test.apache.org/./asfbot-irc-services-and-archives.html">ASFBot: IRC services and archives</a></li>
                    <li><a href="https://infra-test.apache.org/./backup-policy.html">Backup policy</a></li>
                    <li><a href="https://infra-test.apache.org/./writing-a-good-bug-report.html">Writing a good bug report</a></li>
                    <li><a href="https://infra-test.apache.org/./committer-email.html">Committer Email</a></li>
                    <li><a href="https://infra-test.apache.org/./policy-for-outreach-to-committers.html">Policy for Outreach to Committers</a></li>
                    <li><a href="https://infra-test.apache.org/./committers-faqs.html">Committers' FAQs</a></li>
                    <li><a href="https://infra-test.apache.org/./contact-the-infrastructure-team.html">Contact the Infrastructure Team</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/contactinfra.html">Contacting Infrastructure</a></li>
                    <li><a href="https://infra-test.apache.org/./tips-for-apache-project-email-contributors.html">Tips for Apache project email contributors</a></li>
                    <li><a href="https://infra-test.apache.org/./guide-for-new-project-contributors.html">Guide for new project contributors</a></li>
                    <li><a href="https://infra-test.apache.org/./handling-cryptography-within-an-asf-release.html">Handling cryptography within an ASF release</a></li>
                    <li><a href="https://infra-test.apache.org/./confluence-wiki-space-for-your-project.html">Confluence Wiki space for your project</a></li>
                    <li><a href="https://infra-test.apache.org/./requesting-access-to-the-digicert-code-signing-service.html">Requesting access to the Digicert code signing service</a></li>
                    <li class="active"><a href="https://infra-test.apache.org/./using-the-digicert-code-signing-service.html">Using the Digicert code signing service</a></li>
                    <li><a href="https://infra-test.apache.org/./documentation.html">Documentation</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/email.html">Committer e-mail configuration</a></li>
                    <li><a href="https://infra-test.apache.org/./fingerprints.html">Fingerprints</a></li>
                    <li><a href="https://infra-test.apache.org/./github-flavored-markdown.html">GitHub Flavored Markdown</a></li>
                    <li><a href="https://infra-test.apache.org/./getting-started-with-git.html">Getting started with Git</a></li>
                    <li><a href="https://infra-test.apache.org/./git-access-to-apache-subversion-codebases.html">Git access to Apache Subversion codebases</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/git.html">Getting started with Git</a></li>
                    <li><a href="https://infra-test.apache.org/./github-actions-policy.html">GitHub Actions Policy</a></li>
                    <li><a href="https://infra-test.apache.org/./github-actions-and-secrets.html">GitHub Actions and Secrets</a></li>
                    <li><a href="https://infra-test.apache.org/./github-pages-for-projects.html">GitHub Pages for projects</a></li>
                    <li><a href="https://infra-test.apache.org/./roles-for-project-github-repositories.html">Roles for project GitHub repositories</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/github.html">Apache and GitHub</a></li>
                    <li><a href="https://infra-test.apache.org/./host-a-jenkins-or-buildbot-agent.html">Host a Jenkins or Buildbot agent</a></li>
                    <li><a href="https://infra-test.apache.org/./how-to-be-an-apache-software-foundation-download-mirror.html">How to be an Apache Software Foundation download mirror</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/id.html">Changing your account details (self serve)</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/index.html">Committer Documentation</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/index.html">Reference Documentation</a></li>
                    <li><a href="https://infra-test.apache.org/./self-serve-tools.html">Self-serve Tools</a></li>
                    <li><a href="https://infra-test.apache.org/./site-wide-ban-policy.html">Site-wide ban policy</a></li>
                    <li><a href="https://infra-test.apache.org/./details-on-contacting-infra.html">Details on contacting Infra</a></li>
                    <li><a href="https://infra-test.apache.org/./infra-and-the-incubator.html">Infra and the Incubator</a></li>
                    <li><a href="https://infra-test.apache.org/./apache-infrastructure-mailing-lists.html">Apache Infrastructure mailing lists</a></li>
                    <li><a href="https://infra-test.apache.org/./volunteering-for-apache-infrastructure.html">Volunteering for Apache Infrastructure</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/jenkins-docker.html">Using Docker with builds.apache.org</a></li>
                    <li><a href="https://infra-test.apache.org/./guidelines-for-creating-a-jira-ticket.html">Guidelines for creating a Jira ticket</a></li>
                    <li><a href="https://infra-test.apache.org/./how-to-transition-to-a-new-pgp-key.html">How to transition to a new PGP key</a></li>
                    <li><a href="https://infra-test.apache.org/./assembling-license-and-notice-files.html">Assembling LICENSE and NOTICE files</a></li>
                    <li><a href="https://infra-test.apache.org/./localization.html">Localization</a></li>
                    <li><a href="https://infra-test.apache.org/./machines-and-fingerprints.html">Machines and Fingerprints</a></li>
                    <li><a href="https://infra-test.apache.org/./mail-rejection-policy.html">Mail Rejection Policy</a></li>
                    <li><a href="https://infra-test.apache.org/./mailing-list-moderation.html">Mailing list moderation</a></li>
                    <li><a href="https://infra-test.apache.org/./managing-project-committers.html">Managing Project Committers</a></li>
                    <li><a href="https://infra-test.apache.org/./apache-mirroring-information.html">Apache mirroring information</a></li>
                    <li><a href="https://infra-test.apache.org/./guide-for-new-project-committers.html">Guide for new project committers</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/newaccount.html">Guide to new committers</a></li>
                    <li><a href="https://infra-test.apache.org/./open-access-svn.html">Open-access SVN</a></li>
                    <li><a href="https://infra-test.apache.org/./cryptography-with-openpgp.html">Cryptography with OpenPGP</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/opie.html">Using OPIE</a></li>
                    <li><a href="https://infra-test.apache.org/./operating-system-upgrade-policy.html">Operating system upgrade policy</a></li>
                    <li><a href="https://infra-test.apache.org/./how-to-submit-a-patch-for-project-code.html">How to submit a patch for project code</a></li>
                    <li><a href="https://infra-test.apache.org/./build-and-manage-a-project-website-with-pelican-and-buildbot.html">Build and manage a project website with Pelican and Buildbot</a></li>
                    <li><a href="https://infra-test.apache.org/./infra-policies.html">Infra policies</a></li>
                    <li><a href="https://infra-test.apache.org/./project-blog.html">Project Blog</a></li>
                    <li><a href="https://infra-test.apache.org/./project-and-product-names.html">Project and product names</a></li>
                    <li><a href="https://infra-test.apache.org/./project-site-policy.html">Project site policy</a></li>
                    <li><a href="https://infra-test.apache.org/./managing-your-project-web-site.html">Managing your project web site</a></li>
                    <li><a href="https://infra-test.apache.org/./publishing-maven-releases-to-maven-central-repository.html">Publishing Maven Releases to Maven Central Repository</a></li>
                    <li><a href="https://infra-test.apache.org/./subscribe-to-apache-software-foundation-infrastructure-events.html">Subscribe to Apache Software Foundation infrastructure events</a></li>
                    <li><a href="https://infra-test.apache.org/./release-distribution-policy.html">Release Distribution Policy</a></li>
                    <li><a href="https://infra-test.apache.org/./release-download-pages-for-projects.html">Release Download Pages for Projects</a></li>
                    <li><a href="https://infra-test.apache.org/./release-creation-process.html">Release Creation Process</a></li>
                    <li><a href="https://infra-test.apache.org/./signing-releases.html">Signing Releases</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/release.html">Releasing project packages</a></li>
                    <li><a href="https://infra-test.apache.org/./repository-access-policy.html">Repository access policy</a></li>
                    <li><a href="https://infra-test.apache.org/./apache-maven-repositories.html">Apache Maven repositories</a></li>
                    <li><a href="https://infra-test.apache.org/./requesting-an-issue-and-feature-request-tracker-for-a-project.html">Requesting an issue and feature-request tracker for a project</a></li>
                    <li><a href="https://infra-test.apache.org/./response-time.html">Response time</a></li>
                    <li><a href="https://infra-test.apache.org/./roadmap-for-apache-infrastructure.html">Roadmap for Apache Infrastructure</a></li>
                    <li><a href="https://infra-test.apache.org/./self-hosted-runners.html">Self-hosted runners</a></li>
                    <li><a href="https://infra-test.apache.org/./services-and-tools.html">Services and Tools</a></li>
                    <li><a href="https://infra-test.apache.org/./slack-for-asf-projects.html">Slack for ASF projects</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/ssh.html">Setting up SSH for ASF machines</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/start.html">Committer documentation</a></li>
                    <li><a href="https://infra-test.apache.org/./status-pages.html">Status pages</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/subversion.html">Using Subversion</a></li>
                    <li><a href="https://infra-test.apache.org/./subversion-basics.html">Subversion basics</a></li>
                    <li><a href="https://infra-test.apache.org/./svn-to-git-migration.html">SVN to Git migration</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/svngit2jira.html">Subversion and Git integration with JIRA tickets</a></li>
                    <li><a href="https://infra-test.apache.org/./subversion-and-git-integration-with-jira-tickets.html">Subversion and Git integration with Jira tickets</a></li>
                    <li><a href="https://infra-test.apache.org/./about-the-apache-infrastructure-team.html">About the Apache Infrastructure Team</a></li>
                    <li><a href="https://infra-test.apache.org/./understanding-opensource.html">Understanding Opensource</a></li>
                    <li><a href="https://infra-test.apache.org/./user-documentation-for-project-releases.html">User documentation for project releases</a></li>
                    <li><a href="https://infra-test.apache.org/./committer-ssh-configuration-on-windows.html">Committer SSH configuration on Windows</a></li>
                    <li><a href="https://infra-test.apache.org/./committer-ssh-access.html">Committer SSH Access</a></li>
                    <li><a href="https://infra-test.apache.org/./source-code-repositories-at-apache.html">Source Code Repositories at Apache</a></li>
                    <li><a href="https://infra-test.apache.org/./requesting-a-virtual-machine-for-a-project.html">Requesting a virtual machine for a project</a></li>
                    <li><a href="https://infra-test.apache.org/./project-vm-policy.html">Project VM policy</a></li>
                    <li><a href="https://infra-test.apache.org/./guidelines-for-project-websites.html">Guidelines for project websites</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/website-policy.html">Web Site Guidelines</a></li>
                    <li><a href="https://infra-test.apache.org/./reference/committer/website.html">How To Manage any Apache Project's Website</a></li>
                    <li><a href="https://infra-test.apache.org/./writable-git-repositories.html">Writable Git repositories</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
    <h1 class="entry-title">Using the Digicert code signing service</h1>
    
    <h2>Transition to DigiCert</h2>
<p>We have moved from the old Symantec service to the new DigiCert service. The Symanetc service is no longer avaialble. All new signing must be via the DigiCert service.</p>
<p>If you require assistance migrating to the DigiCert service, please open an <a href="https://issues.apache.org/jira/browse/INFRA">INFRA Jira ticket</a> and select code signing as the component.</p>
<h2>DigiCert Secure Software</h2>
<p>DigiCert Secure Software supports a range of signing tools and formats. For the full list see the <a href="https://digicert.github.io/snowbird-doc/#/administration-guides/secure-software-manager/index">client user guide</a>. Whichever signing option you choose, you will need to complete four steps:</p>
<ol>
<li>Obtain a DigiCert ONE account</li>
<li>Obtain credentials for code signing</li>
<li>Install the OS integration for your chosen OS (Windows or Linux)</li>
<li>Configure your chosen signing tool.</li>
</ol>
<h3>Step 1: Obtaining a DigiCert ONE account</h3>
<p>Adding a new PMC or a new user to an existing PMC needs to be performed by the infrastructure team. Please open an <a href="https://issues.apache.org/jira/browse/INFRA">INFRA Jira ticket</a> and select code signing as the component.</p>
<p>When the infrastructure team create your accout you will be sent a password reset email. The link in that email is only valid for 12 hours. If you are unable to complete the creation of your account in that time you can request a new password reset email by going to <a href="https://one.digicert.com/">DigiCert ONE</a> and clicking on the password reset link. Your username is the same as your ASF email address. You should then receive a new password reset email you can use to set your password. You will also need to configure your OTP token. Officially, only Google authenticator is supported but any similar tool should also work.</p>
<h3>Step 2: Obtaining credentials for code signing</h3>
<p>Whatever you need to sign and however you choose to sign it, you will need to create credentials to use the signing API. You create these via the DigiCert ONE web interface.</p>
<ol>
<li>Log on to <a href="https://one.digicert.com/">DigiCert ONE</a>.</li>
<li>Select "Account" from the menu in the top right-hand corner.</li>
<li>Select "Access" in the left-hand menu.</li>
<li>Select "API token" and create a new API token with your ASF id as the name and an expiry date ~1 year in the future.</li>
<li>Keep a record of the token value</li>
<li>Select "Client Auth" and create a new client certificate with your ASF id as the name and an expiry date ~1 year in the future.</li>
<li>Download the certificate and keep a record of the password</li>
</ol>
<h3>Step 3: Install the OS integration</h3>
<h4>Windows integration</h4>
<ol>
<li>Log on to DigiCert ONE and select "Secure Software" from the menu in the top right-hand corner.</li>
<li>Select "Resources" in the left-hand menu.</li>
<li>Download and install the "Secure Software Manager Windows Clients Installer".</li>
<li>As per the <a href="https://digicert.github.io/snowbird-doc/#/administration-guides/secure-software-manager/windows-configuration">Windows Configuration</a> section of the client user guide, create the four system environment variables. These <strong>must</strong> always be set to use the DigiCert signing service.</li>
<li>Test with <code>smctl.exe keypair ls</code>. You should see at least one certificate listed. (smctl.exe is installed as part of the DigiCert client and won't be on your path.)</li>
<li>Test with <code>certutil.exe -csp "DigiCert Signing Manager KSP" -key -user</code>. You should see at least one key listed. (certutil.exe will be on your path.)</li>
<li>Synchronise certificates with <code>smksp_cert_sync.exe</code>.</li>
<li>Open <code>certmgr.msc</code> (it will be on your path) and you should see your code signing certificate(s) listed under personal certificates. If a new certificate is issued to your PMC you will need to repeat this step.</li>
</ol>
<h4>Linux integration</h4>
<ol>
<li>Log on to DigiCert ONE and select "Secure Software" from the menu in the top right-hand corner.</li>
<li>Select "Resources" in the left-hand menu.</li>
<li>Download and install the "Secure Software Manager Linux Clients (Portable tar.gz)".</li>
<li>Unpack the tar.gz. Infra recommends, and this guide assumes, it is unpacked to <code>/opt</code></li>
<li>As per the DigiCert ONE documentation, create the four required environment variables. These <strong>must</strong> always be set to use the DigiCert signing service. Infra recommends you store your certifcate in <code>~/.digicertone/</code>.</li>
<li>Test with <code>/opt/smtools-linux-x64/smctl keypair ls</code>. You should see at least one certificate listed.</li>
</ol>
<h3>Step 4: Configure your chosen signing tool</h3>
<h4>Signing Windows binaries on Windows using signtool.exe</h4>
<p>To sign Windows binaries you will need a copy of SignTool.exe. This can be found in both Visual Studio and the Windows SDK. Very old versions only support SHA-1 signing. Version 6.1.7600.16385 (2009-07-14) supports newer hashes for signing.</p>
<p>You'll need the fingerprint of the certificate you want to use for signing (view via <code>certmgr.msc</code>). You can then sign a file with <code>signtool.exe sign /sha1 &lt;cert-fingerprint&gt; /fd sha512 /tr http://timestamp.digicert.com &lt;file-to-be-signed&gt;</code></p>
<p>To sign a file with SHA-256 rather than SHA-512 use <code>... /fd sha256...</code> rather than <code>... /fd sha512 ...</code>.</p>
<h4>Signing on Windows binaries on Windows with JSign Ant task</h4>
<ol>
<li>Make JSign JAR from <a href="https://search.maven.org/artifact/net.jsign/jsign">Maven Central</a> available to Ant.</li>
<li>
<p>Create the PKCS11 configuration file. Infra recommends saving this as <code>%USERPROFLE%\.digicertone\pkcs11properties.cfg</code>. The contents should be:</p>
<div class="highlight"><pre><span></span><code><span class="err">name=DigiCertONE</span>
<span class="err">library=&quot;C:/Program Files/DigiCert/DigiCert One Signing Manager Tools/smpkcs11.dll&quot;</span>
<span class="err">slotListIndex=0</span>
</code></pre></div>

<p><code>name</code> can be anything you like (although names with spaces and special characters haven't been tested). <code>library</code> must point to where you installed the Secure Software Manager Windows Clients. Note the use of <code>/</code> rather than <code>\</code> in the path even though this is Windows.</p>
</li>
</ol>
<p>When configuring the <a href="https://ebourg.github.io/jsign/#ant">JSign Ant task</a> <code>keystore</code> should be set to the full path of the <code>pkcs11properties.cfg</code> file.</p>
<h4>Signing Windows binaries on Linux with JSign</h4>
<ol>
<li>Download jsign <code>wget https://github.com/ebourg/jsign/releases/download/3.1/jsign_3.1_all.deb</code></li>
<li>Install jsign <code>sudo dpkg --install jsign_3.1_all.deb</code></li>
<li>
<p>Create the PKCS11 configuration file. Infra recommends saving this as <code>~/.digicertone/pkcs11properties.cfg</code>. The contents should be:</p>
<div class="highlight"><pre><span></span><code><span class="err">name=DigiCertONE</span>
<span class="err">library=&quot;/opt/smtools-linux-x64/smpkcs11.so&quot;</span>
<span class="err">slotListIndex=0</span>
</code></pre></div>

<p><code>name</code> can be anything you like (although names with spaces and special characters haven't been tested). <code>library</code> must point to where you installed the Secure Software Manager Linux Clients.
1. You should then be able to sign with:</p>
<div class="highlight"><pre><span></span><code><span class="err">jsign --keystore ~/.digicertone/pkcs11properties.cfg --storepass NONE --storetype PKCS11 --alias &quot;&lt;Your PMC Key alias&gt;&quot; --alg SHA-512 --tsaurl http://timestamp.digicert.com &lt;file-to-be-signed&gt;</span>
</code></pre></div>

</li>
</ol>
<h4>Signing Windows binaries on Linux with JSign Ant task</h4>
<ol>
<li>Make JSign JAR from <a href="https://search.maven.org/artifact/net.jsign/jsign">Maven Central</a> available to Ant.</li>
<li>
<p>Create the PKCS11 configuration file. Infra recommends saving this as <code>~/.digicertone/pkcs11properties.cfg</code>. The contents should be:</p>
<div class="highlight"><pre><span></span><code><span class="err">name=DigiCertONE</span>
<span class="err">library=&quot;/opt/smtools-linux-x64/smpkcs11.so&quot;</span>
<span class="err">slotListIndex=0</span>
</code></pre></div>

<p><code>name</code> can be anything you like (although names with spaces and special characters haven't been tested). <code>library</code> must point to where you installed the Secure Software Manager Linux Clients.</p>
</li>
</ol>
<p>When configuring the <a href="https://ebourg.github.io/jsign/#ant">JSign Ant task</a> <code>keystore</code> should be set to the full path of the <code>pkcs11properties.cfg</code> file.</p>
<h4>Other signing formats, tools and operating systems</h4>
<p>See the client user guide.</p>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />
        <title>Subscribe to Apache Software Foundation infrastructure events</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="A Pelican Blog Atom Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">A Pelican Blog</a></h1>
                <nav><ul>
                    <li><a href="/pages/oauth-two-factor-authentication.html">OAuth Two-Factor Authentication</a></li>
                    <li><a href="/pages/asf-account-management.html">ASF account management</a></li>
                    <li><a href="/pages/apache-and-github.html">Apache and GitHub</a></li>
                    <li><a href="/pages/application-upgrades-policy-and-workflow.html">Application upgrades policy and workflow</a></li>
                    <li><a href="/pages/distributing-through-the-apple-developer-program.html">Distributing through the Apple Developer Program</a></li>
                    <li><a href="/pages/applying-the-apache-license-version-20.html">Applying the Apache license, version 2.0</a></li>
                    <li><a href="/pages/asf-pelican-build-process.html">ASF-Pelican build process</a></li>
                    <li><a href="/pages/configuring-asf-pelican.html">Configuring ASF Pelican</a></li>
                    <li><a href="/pages/asf-pelican-data-model.html">ASF Pelican data model</a></li>
                    <li><a href="/pages/asf-pelican-getting-started-guide.html">ASF-Pelican getting-started guide</a></li>
                    <li><a href="/pages/local-pelican-builds.html">Local Pelican builds</a></li>
                    <li><a href="/pages/asf-pelican-plugins.html">ASF Pelican plugins</a></li>
                    <li><a href="/pages/apache-theme-for-asf-pelican.html">Apache Theme for ASF Pelican</a></li>
                    <li><a href="/pages/asf-pelican.html">ASF-Pelican</a></li>
                    <li><a href="/pages/asfbot-irc-services-and-archives.html">ASFBot: IRC services and archives</a></li>
                    <li><a href="/pages/project-sites-using-mkdocs.html">Project sites using MKDocs</a></li>
                    <li><a href="/pages/backup-policy.html">Backup policy</a></li>
                    <li><a href="/pages/writing-a-good-bug-report.html">Writing a good bug report</a></li>
                    <li><a href="/pages/committer-email.html">Committer Email</a></li>
                    <li><a href="/pages/policy-for-outreach-to-committers.html">Policy for Outreach to Committers</a></li>
                    <li><a href="/pages/committers-faqs.html">Committers' FAQs</a></li>
                    <li><a href="/pages/contact-the-infrastructure-team.html">Contact the Infrastructure Team</a></li>
                    <li><a href="/pages/tips-for-apache-project-email-contributors.html">Tips for Apache project email contributors</a></li>
                    <li><a href="/pages/guide-for-new-project-contributors.html">Guide for new project contributors</a></li>
                    <li><a href="/pages/handling-cryptography-within-an-asf-release.html">Handling cryptography within an ASF release</a></li>
                    <li><a href="/pages/confluence-wiki-space-for-your-project.html">Confluence Wiki space for your project</a></li>
                    <li><a href="/pages/requesting-access-to-the-digicert-code-signing-service.html">Requesting access to the Digicert code signing service</a></li>
                    <li><a href="/pages/using-the-digicert-code-signing-service.html">Using the Digicert code signing service</a></li>
                    <li><a href="/pages/documentation.html">Documentation</a></li>
                    <li><a href="/pages/docker-hub-use-policy.html">Docker Hub use policy</a></li>
                    <li><a href="/pages/reference/committer/email.html">Committer e-mail configuration</a></li>
                    <li><a href="/pages/fingerprints.html">Fingerprints</a></li>
                    <li><a href="/pages/github-flavored-markdown.html">GitHub Flavored Markdown</a></li>
                    <li><a href="/pages/getting-started-with-git.html">Getting started with Git</a></li>
                    <li><a href="/pages/git-access-to-apache-subversion-codebases.html">Git access to Apache Subversion codebases</a></li>
                    <li><a href="/pages/reference/committer/git.html">Getting started with Git</a></li>
                    <li><a href="/pages/github-actions-policy.html">GitHub Actions Policy</a></li>
                    <li><a href="/pages/github-actions-and-secrets.html">GitHub Actions and Secrets</a></li>
                    <li><a href="/pages/github-pages-for-projects.html">GitHub Pages for projects</a></li>
                    <li><a href="/pages/roles-for-project-github-repositories.html">Roles for project GitHub repositories</a></li>
                    <li><a href="/pages/reference/committer/github.html">Apache and GitHub</a></li>
                    <li><a href="/pages/glossary.html">Glossary</a></li>
                    <li><a href="/pages/host-a-jenkins-or-buildbot-agent.html">Host a Jenkins or Buildbot agent</a></li>
                    <li><a href="/pages/how-to-mirror-asf-software-releases-locally.html">How to mirror ASF software releases locally</a></li>
                    <li><a href="/pages/reference/committer/id.html">Changing your account details (self serve)</a></li>
                    <li><a href="/pages/infra.html">Infra</a></li>
                    <li><a href="/pages/reference/committer/index.html">Committer Documentation</a></li>
                    <li><a href="/pages/reference/index.html">Reference Documentation</a></li>
                    <li><a href="/pages/site-wide-ban-policy.html">Site-wide ban policy</a></li>
                    <li><a href="/pages/details-on-contacting-infra.html">Details on contacting Infra</a></li>
                    <li><a href="/pages/infra-and-the-incubator.html">Infra and the Incubator</a></li>
                    <li><a href="/pages/apache-infrastructure-mailing-lists.html">Apache Infrastructure mailing lists</a></li>
                    <li><a href="/pages/volunteering-for-apache-infrastructure.html">Volunteering for Apache Infrastructure</a></li>
                    <li><a href="/pages/reference/committer/jenkins-docker.html">Using Docker with builds.apache.org</a></li>
                    <li><a href="/pages/guidelines-for-creating-a-jira-ticket.html">Guidelines for creating a Jira ticket</a></li>
                    <li><a href="/pages/how-to-transition-to-a-new-pgp-key.html">How to transition to a new PGP key</a></li>
                    <li><a href="/pages/assembling-license-and-notice-files.html">Assembling LICENSE and NOTICE files</a></li>
                    <li><a href="/pages/localization.html">Localization</a></li>
                    <li><a href="/pages/machines-and-fingerprints.html">Machines and Fingerprints</a></li>
                    <li><a href="/pages/mailing-list-migration-project.html">Mailing List Migration Project</a></li>
                    <li><a href="/pages/mail-rejection-policy.html">Mail Rejection Policy</a></li>
                    <li><a href="/pages/mailing-list-moderation.html">Mailing list moderation</a></li>
                    <li><a href="/pages/managing-project-committers.html">Managing Project Committers</a></li>
                    <li><a href="/pages/apache-download-mirror-system.html">Apache download mirror system</a></li>
                    <li><a href="/pages/guide-for-new-project-committers.html">Guide for new project committers</a></li>
                    <li><a href="/pages/reference/committer/newaccount.html">Guide to new committers</a></li>
                    <li><a href="/pages/nexus-101.html">Nexus 101</a></li>
                    <li><a href="/pages/open-access-svn.html">Open-access SVN</a></li>
                    <li><a href="/pages/cryptography-with-openpgp.html">Cryptography with OpenPGP</a></li>
                    <li><a href="/pages/reference/committer/opie.html">Using OPIE</a></li>
                    <li><a href="/pages/operating-system-upgrade-policy.html">Operating system upgrade policy</a></li>
                    <li><a href="/pages/how-to-submit-a-patch-for-project-code.html">How to submit a patch for project code</a></li>
                    <li><a href="/pages/build-and-manage-a-project-website-with-pelican-and-buildbot.html">Build and manage a project website with Pelican and Buildbot</a></li>
                    <li><a href="/pages/infra-policies.html">Infra policies</a></li>
                    <li><a href="/pages/project-blog.html">Project Blog</a></li>
                    <li><a href="/pages/project-and-product-names.html">Project and product names</a></li>
                    <li><a href="/pages/project-code-repository-policy.html">Project Code Repository Policy</a></li>
                    <li><a href="/pages/project-site-policy.html">Project site policy</a></li>
                    <li><a href="/pages/managing-your-project-web-site.html">Managing your project web site</a></li>
                    <li><a href="/pages/publishing-maven-releases-to-maven-central-repository.html">Publishing Maven Releases to Maven Central Repository</a></li>
                    <li class="active"><a href="/pages/subscribe-to-apache-software-foundation-infrastructure-events.html">Subscribe to Apache Software Foundation infrastructure events</a></li>
                    <li><a href="/pages/release-distribution-policy.html">Release Distribution Policy</a></li>
                    <li><a href="/pages/release-download-pages-for-projects.html">Release Download Pages for Projects</a></li>
                    <li><a href="/pages/release-creation-process.html">Release Creation Process</a></li>
                    <li><a href="/pages/signing-releases.html">Signing Releases</a></li>
                    <li><a href="/pages/reference/committer/release.html">Releasing project packages</a></li>
                    <li><a href="/pages/apache-maven-repositories.html">Apache Maven repositories</a></li>
                    <li><a href="/pages/requesting-an-issue-and-feature-request-tracker-for-a-project.html">Requesting an issue and feature-request tracker for a project</a></li>
                    <li><a href="/pages/response-time.html">Response time</a></li>
                    <li><a href="/pages/roadmap-for-apache-infrastructure.html">Roadmap for Apache Infrastructure</a></li>
                    <li><a href="/pages/self-hosted-runners.html">Self-hosted runners</a></li>
                    <li><a href="/pages/services-and-tools.html">Services and Tools</a></li>
                    <li><a href="/pages/slack-for-asf-projects.html">Slack for ASF projects</a></li>
                    <li><a href="/pages/dealing-with-spam-in-your-asf-email-account.html">Dealing with spam in your ASF email account</a></li>
                    <li><a href="/pages/reference/committer/start.html">Committer documentation</a></li>
                    <li><a href="/pages/status-pages.html">Status pages</a></li>
                    <li><a href="/pages/reference/committer/subversion.html">Using Subversion</a></li>
                    <li><a href="/pages/subversion-basics.html">Subversion basics</a></li>
                    <li><a href="/pages/svn-to-git-migration.html">SVN to Git migration</a></li>
                    <li><a href="/pages/reference/committer/svngit2jira.html">Subversion and Git integration with JIRA tickets</a></li>
                    <li><a href="/pages/subversion-and-git-integration-with-jira-tickets.html">Subversion and Git integration with Jira tickets</a></li>
                    <li><a href="/pages/about-the-apache-infrastructure-team.html">About the Apache Infrastructure Team</a></li>
                    <li><a href="/pages/understanding-opensource.html">Understanding Opensource</a></li>
                    <li><a href="/pages/user-documentation-for-project-releases.html">User documentation for project releases</a></li>
                    <li><a href="/pages/committer-ssh-access.html">Committer SSH Access</a></li>
                    <li><a href="/pages/source-code-repositories-at-apache.html">Source Code Repositories at Apache</a></li>
                    <li><a href="/pages/requesting-a-virtual-machine-for-a-project.html">Requesting a virtual machine for a project</a></li>
                    <li><a href="/pages/managing-virtual-machines.html">Managing virtual machines</a></li>
                    <li><a href="/pages/project-vm-policy.html">Project VM policy</a></li>
                    <li><a href="/pages/guidelines-for-project-websites.html">Guidelines for project websites</a></li>
                    <li><a href="/pages/reference/committer/website-policy.html">Web Site Guidelines</a></li>
                    <li><a href="/pages/reference/committer/website.html">How To Manage any Apache Project's Website</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
    <h1 class="entry-title">Subscribe to Apache Software Foundation infrastructure events</h1>
    
    <p>The ASF employs a plain-text publisher/subscriber service called <strong>PyPubSub</strong> at <code>pubsub.apache.org:2069</code>, which lists most events that happen within the Foundation's infrastructure.</p>
<p>Currently, the service streams the following events:</p>
<ul>
<li>Subversion commits</li>
<li>Git commits and pushes</li>
<li>Emails to publicly archived lists</li>
<li>JIRA updates</li>
<li>Pull Requests and Issues from GitHub</li>
<li>Staging and publishing notifications sent via our <a href="https://s.apache.org/asfyaml">.asf.yaml</a> offering.</li>
</ul>
<p>Events are delivered as JSON objects in a <a href="https://en.wikipedia.org/wiki/Chunked_transfer_encoding" target="_blank">chunked response stream</a>, with each new chunk being either an event payload or a keep-alive ping. </p>
<h2>How to subscribe</h2>
<p>Subscribers can pick one or multiple topics to subscribe to, with more specific subscriptions getting fewer, but more specific, event payloads. Construct subscriptions in the form of: <code>http://pubsub.apache.org:2069/topics/go/here</code>, and separate the topics you want to subscribe to with forward slashes. </p>
<p>The service returns events that match <em>all</em> of the topics you are subscribed to.
To subscribe to multiple topic batches in an OR'ed way, you may use a comma to separate your batches of topics.</p>
<p>Some examples:</p>
<ul>
<li>To subscribe to all svn commits; <code>http://pubsub.apache.org:2069/svn/commit</code></li>
<li>To subscribe to all git commits; <code>http://pubsub.apache.org:2069/git/commit</code></li>
<li>To subscribe to all git events (push+commit) for whimsy.git; <code>http://pubsub.apache.org:2069/git/whimsy</code></li>
<li>To subscribe to all <code>netbeans.apache.org</code> emails: <code>http://pubsub.apache.org:2069/email/netbeans.apache.org</code></li>
<li>To subscribe to PRs opened against <code>beam-foo.git</code>: <code>http://pubsub.apache.org:2069/github/beam-foo.git/pr</code></li>
<li>To subscribe to all commits, both Subversion and git: <code>http://pubsub.apache.org:2069/commit</code></li>
<li>To subscribe to all JIRA events for the HADOOP JIRA instance: <code>http://pubsub.apache.org:2069/jira/HADOOP</code></li>
<li>To subscribe to <em>both</em> JIRA and email streams for tomcat in one go: <code>http://pubsub.apache.org:2069/jira/TOMCAT,email/tomcat.apache.org</code></li>
</ul>
<p>Public SVN repo topics consist of 'svn', the first one or two path segments after the /repo/ in the URL, and 'commit'.
For example, changes to the repository <code>https://dist.apache.org/repos/dist/release/</code> have the topics <code>svn/dist/release/commit</code>.
A commit that involves changes to both <code>dist/release</code> and <code>dist/dev</code> has the topics <code>svn/dist/commit</code>.
Note that <code>svn/dist/release/commit</code> will not match, because the topics in the response do not include <code>release</code>.</p>
<p>Private SVN repos topics are constructed in the same way, but have an additional 'private' topic.
For example <code>https://pubsub.apache.org:2070/private/svn/private/committers/commit</code> returns commits for
<code>https://svn.apache.org/repos/private/committers/board/</code></p>
<h2>Event payload examples</h2>
<p>Pings are simple objects like this:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;stillalive&quot;</span><span class="p">:</span> <span class="mf">1583973410.9620552</span><span class="p">}</span>
</code></pre></div>

<p>An example of a real event payload, in this case a git commit, could be (emails redacted in this example):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;commit&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;body&quot;</span><span class="p">:</span> <span class="s2">&quot;[maven-release-plugin] prepare for next development iteration\n&quot;</span><span class="p">,</span>
        <span class="nt">&quot;committer&quot;</span><span class="p">:</span> <span class="s2">&quot;sblackmon &lt;s...@apache.org&gt;&quot;</span><span class="p">,</span>
        <span class="nt">&quot;hash&quot;</span><span class="p">:</span> <span class="s2">&quot;8e6f956&quot;</span><span class="p">,</span>
        <span class="nt">&quot;log&quot;</span><span class="p">:</span> <span class="s2">&quot;[maven-release-plugin] prepare for next development iteration&quot;</span><span class="p">,</span>
        <span class="nt">&quot;repository&quot;</span><span class="p">:</span> <span class="s2">&quot;git&quot;</span><span class="p">,</span>
        <span class="nt">&quot;sha&quot;</span><span class="p">:</span> <span class="s2">&quot;8e6f956c2eda06ca9debf21634cedcecc96293ff&quot;</span><span class="p">,</span>
        <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;sblackmon&quot;</span><span class="p">,</span>
        <span class="nt">&quot;files&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pom.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;streams-cli/pom.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;streams-components/pom.xml&quot;</span><span class="p">],</span>
        <span class="nt">&quot;server&quot;</span><span class="p">:</span> <span class="s2">&quot;gitbox&quot;</span><span class="p">,</span>
        <span class="nt">&quot;project&quot;</span><span class="p">:</span> <span class="s2">&quot;streams&quot;</span><span class="p">,</span>
        <span class="nt">&quot;autopublish&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nt">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;Wed Mar 11 19:25:06 2020 -0500&quot;</span><span class="p">,</span>
        <span class="nt">&quot;commited&quot;</span><span class="p">:</span> <span class="s2">&quot;Wed Mar 11 19:25:06 2020 -0500&quot;</span><span class="p">,</span>
        <span class="nt">&quot;subject&quot;</span><span class="p">:</span> <span class="s2">&quot;[maven-release-plugin] prepare for next development iteration&quot;</span><span class="p">,</span>
        <span class="nt">&quot;ref&quot;</span><span class="p">:</span> <span class="s2">&quot;refs/heads/master&quot;</span><span class="p">,</span>
        <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;s...@apache.org&quot;</span><span class="p">,</span>
        <span class="nt">&quot;authored&quot;</span><span class="p">:</span> <span class="s2">&quot;Wed Mar 11 19:25:06 2020 -0500&quot;</span><span class="p">,</span>
        <span class="nt">&quot;ref_names&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;pubsub_topics&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;git&quot;</span><span class="p">,</span> <span class="s2">&quot;streams&quot;</span><span class="p">,</span> <span class="s2">&quot;commit&quot;</span><span class="p">],</span>
    <span class="nt">&quot;pubsub_path&quot;</span><span class="p">:</span> <span class="s2">&quot;/git/streams/commit&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>Payloads vary depending on what they represent, so check both what sub-objects are present in the payload and the <code>pubsub_path</code> variable, which will show the full payload event path and explain which type is being sent.</p>
<h2>Try it yourself</h2>
<p>To try it out and take a look at the event stream, use <a href="https://en.wikipedia.org/wiki/CURL">cURL</a> in your terminal:</p>
<div class="highlight"><pre><span></span><code>curl http://pubsub.apache.org:2069/git/commit
</code></pre></div>

<p><br/></p>
<p>A secure version also exists on port 2070, for use with authenticated event streams:</p>
<div class="highlight"><pre><span></span><code>curl https://pubsub.apache.org:2070/git/commit
</code></pre></div>

<p>Please note that due to limitations in our TLS terminator, payloads larger than 64kb are split into 64kb chunks on
port 2070. If you are using port 2070, you should ensure that the data you receive is terminated with a newline (\n),
or continue fetching data till you hit a chunk terminated with a newline.</p>
<h2>Using PyPubSub in programming</h2>
<h3>Using PyPubSub with Python</h3>
<p>You can listen for and react to payloads in Python using the <a href="https://pypi.org/project/asfpy/">asfpy</a> pip package:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">asfpy.pubsub</span>

<span class="k">def</span> <span class="nf">process_event</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Got an event from PyPubSub!&quot;</span><span class="p">)</span>
   <span class="o">...</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">pubsub</span> <span class="o">=</span> <span class="n">asfpy</span><span class="o">.</span><span class="n">pubsub</span><span class="o">.</span><span class="n">Listener</span><span class="p">(</span><span class="s1">&#39;http://pubsub.apache.org:2069/&#39;</span><span class="p">)</span>
    <span class="n">pubsub</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">process_event</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<h3>Using PyPubSub with node.js</h3>
<p>This sample snippet lets you use <code>node.js</code> for listening for and processing pubsub events:</p>
<div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">https</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;https&quot;</span><span class="p">);</span>

<span class="kr">class</span> <span class="nx">PyPubSub</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">getter</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^https/i</span><span class="p">)</span> <span class="o">?</span> <span class="nx">https</span> <span class="o">:</span> <span class="nx">http</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">attach</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">getter</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="nx">res</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">setEncoding</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">);</span>
            <span class="kd">let</span> <span class="nx">body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="nx">data</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="c1">// Be mindful of proxies that split pubsub chunks into smaller ones,</span>
        <span class="c1">// only load the JSON blob once we hit a newline (\n)</span>
                <span class="nx">body</span> <span class="o">+=</span> <span class="nx">data</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">))</span> <span class="p">{</span>
                    <span class="kd">let</span> <span class="nx">payload</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
                    <span class="nx">body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
                    <span class="nx">func</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
                <span class="p">}</span>
              <span class="p">});</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="c1">// Test</span>
<span class="kd">function</span> <span class="nx">process</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ping-back?</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">stillalive</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Got a ping-back&quot;</span><span class="p">);</span>
    <span class="c1">// Actual payload? process it!</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Got a payload from PyPubSub!&quot;</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">pps</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PyPubSub</span><span class="p">(</span><span class="s1">&#39;http://pubsub.apache.org:2069/&#39;</span><span class="p">);</span>
<span class="nx">pps</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">process</span><span class="p">);</span>
</code></pre></div>

<h3>Using PyPubSub with Ruby</h3>
<p>This sample lets you connect to our pubsub service via Ruby:</p>
<div class="highlight"><pre><span></span><code><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;json&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;thread&#39;</span>

<span class="n">pubsub_URL</span> <span class="o">=</span> <span class="s1">&#39;https://pubsub.apache.org:2070/&#39;</span>

<span class="k">def</span> <span class="nf">do_stuff_with</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Got a pubsub event!:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">listen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="n">ps_thread</span> <span class="o">=</span> <span class="no">Thread</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
    <span class="k">begin</span>
      <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
      <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">uri</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">uri</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="ss">:use_ssl</span> <span class="o">=&gt;</span> <span class="n">url</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/^https:/</span><span class="p">)</span> <span class="p">?</span> <span class="kp">true</span> <span class="p">:</span> <span class="kp">false</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
        <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="o">.</span><span class="n">new</span> <span class="n">uri</span><span class="o">.</span><span class="n">request_uri</span>
        <span class="n">http</span><span class="o">.</span><span class="n">request</span> <span class="n">request</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
          <span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
          <span class="n">response</span><span class="o">.</span><span class="n">read_body</span> <span class="k">do</span> <span class="o">|</span><span class="n">chunk</span><span class="o">|</span>
            <span class="n">body</span> <span class="o">+=</span> <span class="n">chunk</span>
        <span class="c1"># All chunks are terminated with \n. Since 2070 can split events into 64kb sub-chunks</span>
        <span class="c1"># we wait till we have gotten a newline, before trying to parse the JSON.</span>
            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">end_with?</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
              <span class="n">event</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">chomp</span><span class="p">)</span>
              <span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
              <span class="k">if</span> <span class="n">event</span><span class="o">[</span><span class="s1">&#39;stillalive&#39;</span><span class="o">]</span>  <span class="c1"># pingback</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ping? PONG!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
              <span class="k">else</span>
                <span class="n">do_stuff_with</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
              <span class="k">end</span>
            <span class="k">end</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">rescue</span> <span class="no">Errno</span><span class="o">::</span><span class="no">ECONNREFUSED</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="n">restartable</span> <span class="o">=</span> <span class="kp">true</span>
      <span class="no">STDERR</span><span class="o">.</span><span class="n">puts</span> <span class="n">e</span>
      <span class="nb">sleep</span> <span class="mi">3</span>
    <span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="no">STDERR</span><span class="o">.</span><span class="n">puts</span> <span class="n">e</span>
      <span class="no">STDERR</span><span class="o">.</span><span class="n">puts</span> <span class="n">e</span><span class="o">.</span><span class="n">backtrace</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="k">return</span> <span class="n">ps_thread</span>
<span class="k">end</span>

<span class="k">begin</span>
  <span class="n">ps_thread</span> <span class="o">=</span> <span class="n">listen</span><span class="p">(</span><span class="n">pubsub_URL</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pubsub thread started, waiting for results...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="k">while</span> <span class="n">ps_thread</span><span class="o">.</span><span class="n">alive?</span>
    <span class="nb">sleep</span> <span class="mi">10</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<h2>Want to know more? Have questions?</h2>
<p>To learn more, or just get some questions answered, please contact us at <code>users@infra.apache.org</code>, and we'll try our best to help you out.</p>
<h2>Acknowledgements</h2>
<p>PyPubSub is based on <a href="https://paul.querna.org/articles/2010/10/22/evolution-of-apaches-websites/">SvnPubSub</a>
and <a href="https://www.apache.org/dev/gitpubsub.html">gitpubsub</a>. We wish to thank the Subversion project for building the precursor to this service.</p>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>